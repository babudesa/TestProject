<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Encryption Changes with Archiving and Snapshots</title>
    <link rel="StyleSheet" href="css/encryption.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body style="" onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>ClaimCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="encryption.23.1.html#2387611">Encryption Integration</a> : Encryption Changes with Archiving and Snapshots</span></div>
    <hr align="left" />
    <div>
      <div class="H1_-_Heading_1"><a name="2387611">Encryption Changes with Archiving and Snapshots</a></div>
      <div class="B_-_Body"><a name="2387569">On server startup with archive mode off, the following changes trigger the upgrader to update encryption settings </a>in the main database:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2387637">Adding encrypted properties</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2387647">Removing encrypted properties</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2387654">Adding an encryption plugin for the first time.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2387661">Changing the encryption algorithm. The server looks for a changed value for the </a><span class="e_-_emphasis">encryption ID</span> of the current encryption plugin. For related informatin, see <a href="javascript:WWHClickedPopup('integration', 'encryption.23.3.html#2388115', '');" title="Changing Your Encryption Algorithm Later">"Changing Your Encryption Algorithm Later"</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2387630">However, the upgrader </a><span class="s_-_strong">does</span> <span class="s_-_strong">not upgrade claim snapshots</span> during the normal upgrade process. </div>
      <div class="B_-_Body"><a name="2389562">After startup, a work queue runs that eventually converts all claim snapshots to use the current encryption </a>settings (decrypting if necessary then encrypting). For details of the Encryption Upgrade work queue, see <a href="javascript:WWHClickedPopup('admin', 'batch.12.5.html#1631743', '');" title="Batch Processes and Distributed Work Queues">“Batch Processes and Distributed Work Queues” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('admin', 'batch.12.5.html#1631743', '');" title="Batch Processes and Distributed Work Queues">System Administration Guide</a></span>.</div>
      <div class="B_-_Body"><a name="2389536">However, claim snapshots also upgrade on demand if necessary. In other words, suppose the work queue is </a>running but is not complete and did not yet upgrade some claim snapshots. If a user views one of those claim snapshots, ClaimCenter immediately upgrades the encryption in the snapshot as part of accessing the snapshot.</div>
      <div class="B_-_Body"><a name="2389480">To control the number of claim snapshots upgraded at one time, set the </a><span class="cv_-_computer_voice">SnapshotEncryptionUpgradeChunkSize</span> configuration parameter to the number of claims to upgrade each time the worker runs. This is typically once a day.</div>
      <div class="B_-_Body"><a name="2390370">To force the snapshot upgrade to occur all at once, set the parameter to 0 (process all snapshots at once). Next, </a>manually run the Encryption Upgrade work queue writer from the tools page after the usual database upgrade completes.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2390475">Think carefully before </a><span class="cv_-_computer_voice">SnapshotEncryptionUpgradeChunkSize</span> to 0 to process all snapshots. This can take a very long time. Your servers could be busy running worker threads to decrypt the snapshots for a long time instead of one chunk every night at 1 AM when usage needs are low.</div>
      <div class="B_-_Body"><a name="2389455">This information applies only to claim snapshots in the main database. For information about claim snapshots in </a>the archive databases, see <a href="javascript:WWHClickedPopup('integration', 'encryption.23.4.html#2387742', '');" title="Encryption Changes with Archiving and Snapshots">"Archived Claims"</a>.</div>
      <div class="H2_-_Heading_2"><a name="2387742">Archived Claims</a></div>
      <div class="B_-_Body"><a name="2387844">On server startup with archive mode off, the upgrader does </a><span class="s_-_strong">not upgrade archived claims </span>during the normal upgrade process. To upgrade claims in archive databases, simply start the server in <span class="e_-_emphasis">archive mode</span>. </div>
      <div class="B_-_Body"><a name="2390292">However, this process does </a><span class="s_-_strong">not upgrade claim snapshots in archived claims</span>. If an archived claim is restored at a later time, the server upgrades the claim snapshot to the current encryption settings as part of restoring the claim. </div>
      <div class="B_-_Body"><a name="2390385">In contrast to the main database, if the server is in archive mode, the work queue to upgrade claim snapshots does </a><span class="s_-_strong">not</span> run. The upgrade batch process does <span class="s_-_strong">not</span> run automatically on the archive server. Additionally, running the batch process manually on the archive server is unsupported. Any non-upgraded claim snapshots in archive databases remain in their non-upgrade state. </div>
      <div class="B_-_Body"><a name="2390396">If the claim is ever restored, the server upgrades the encryption settings on the claim snapshots as part of </a>restoring the claim.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2389724">Any claim snapshots in archive databases with out-of-date encryption remain in their </a>non-upgrade state until the claim is restored. The work queue that runs in the main database to upgrade snapshots does <span class="s_-_strong">not</span> run when the server is in archive mode.</div>
      <div class="HS_-_Head_Sub"><a name="2388443">Special Issues For Changing Your Encryption Algorithm</a></div>
      <div class="B_-_Body"><a name="2389824">As mentioned earlier, the work queue that runs in the main database to upgrade snapshots does </a><span class="s_-_strong">not</span> run for claim archives. This means that claim snapshots in archived claims may have used encryption algorithms that are no longer the current encryption algorithm. </div>
      <div class="B_-_Body"><a name="2390313">Because of this, even after running the upgrader in archive mode, you must continue to register your encryption </a>plugins for your old encryption algorithm. The encryption ID for the plugin that encrypted the snapshot is stored in the snapshot. If that claim is restored, ClaimCenter needs that encryption plugin to decrypt the snapshot as part of restoring the claim.</div>
      <div class="B_-_Body"><a name="2388463">This means you must register multiple encryption plugins. Register one encryption plugin implementation for </a>every encryption algorithm that might be referenced (by encryption ID) in any claim snapshots. Be sure that all your plugin implementations return the correct <span class="e_-_emphasis">encryption ID</span> so ClaimCenter can identify which plugin to use to decrypt the snapshots.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </div>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>