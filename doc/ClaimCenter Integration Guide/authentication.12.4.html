<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>User Authentication Service Plugin</title>
    <link rel="StyleSheet" href="css/authentication.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>ClaimCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="authentication.12.1.html#1454315">Authentication Integration</a> : User Authentication Service Plugin</span></div>
    <hr align="left" />
    <blockquote>
      <div class="H1_-_Heading_1"><a name="1454315">User Authentication Service Plugin</a></div>
      <div class="B_-_Body"><a name="1454316">An authentication service plugin (</a><span class="cv_-_computer_voice">AuthenticationServicePlugin</span>) defines an external service that could authenticate a user. Typically, this would involve sending authentication credentials encapsulated in an <span class="e_-_emphasis">authenti</span><span class="e_-_emphasis">cation source</span> and sending them to some separate centralized server on the network such as an LDAP server. This plugin is in the <span class="cv_-_computer_voice">gw.plugin.security</span> package namespace.</div>
      <div class="B_-_Body"><a name="1855695">You can use the following mechanisms to log in to ClaimCenter:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1855696">Log into the web application user interface, as a standard user.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1855697">Log into the server through Guidewire Studio.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1855845">From a SOAP API call, log in as a user with SOAP API privileges.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1855847">The </a><span class="cv_-_computer_voice">AuthenticationServicePlugin</span> <span class="s_-_strong">must</span> handle all three types of logging in. For Guidewire Studio users and SOAP API calls, the credentials passed to this plugin is the standard <span class="cv_-_computer_voice">UserNamePasswordAuthenticationSource,</span> which contains a basic username and password. In addition, if you design a custom authentication source with data extracted from a web application login request, this plugin must be able to handle those credentials too. </div>
      <div class="B_-_Body"><a name="1856048">There are three parts of implementing this plugin, each of which is handled by a plugin interface method:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="1856049">Initialization.</a></span><span class="cv_-_computer_voice"> </span>An authentication plugin must initialize itself in the plugin’s <span class="cv_-_computer_voice">init</span> method.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="1856050">Setting callbacks.</a></span> A plugin can look up and modify user information as part of the authentication process by using the plugin’s <span class="cv_-_computer_voice">setCallback</span> method. This method provides the plugin with a call back handler (<span class="cv_-_computer_voice">CallbackHandler</span>) in this method. Your plugin must save the callback handler reference in a class variable to use it later to make any changes during authentication.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="1832957">Authentication.</a></span> Authentication decisions from a username and password are performed in the <span class="cv_-_computer_voice">authenticate</span> method. The logic in this method can be almost anything you want, but typically would consult a central authentication database. The basic example included with the product uses the <span class="cv_-_computer_voice">CallbackHandler</span> to check for the user within ClaimCenter. The JAAS example calls a JAAS provider to check credentials. Then, it looks up the user’s public ID in ClaimCenter by username using the <span class="cv_-_computer_voice">CallbackHandler</span> to determine which user authenticated.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1537549">Every </a><span class="cv_-_computer_voice">AuthenticationServicePlugin</span> must support the default <span class="cv_-_computer_voice">UserNamePasswordAuthenticationSource</span> because this source is used by Guidewire Studio and web service API clients if connecting to the ClaimCenter server. A custom implementation must also support any other Authentication Sources that may be created by your custom <span class="e_-_emphasis">authentication source creator plugin</span>, if any.</div>
      <div class="B_-_Body"><a name="1454348">Almost every authentication service plugin uses the </a><span class="cv_-_computer_voice">CallbackHandler</span> provided to it, if only to look up the public ID of the user after verifying credentials. Find the Javadoc for this interface in the class <span class="cv_-_computer_voice">AuthenticationServicePluginCallbackHandler</span>. This utility class includes four utility methods:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="1856001">findUser</a></span> – Lets your code look up a user’s public ID based on login user name</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="1954151">verifyInternalCredential</a></span> – Supports testing a username and password against the values stored in the main user database. This method is used by the default authentication service.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="1954153">modifyUser</a></span> – After getting current user data and making changes, perhaps based on contact information stored externally, this method allows the plugin to update the user’s information in ClaimCenter.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1855966">For more details of the method signatures, refer to the Java API Reference Javadoc for </a><span class="cv_-_computer_voice">AuthenticationServicePlugin</span>.</div>
      <div class="HS_-_Head_Sub"><a name="2037182">Synchronizing User Roles</a></div>
      <div class="B_-_Body"><a name="2037183">There is a </a><span class="cv_-_computer_voice">config.xml</span> configuration parameter <span class="cv_-_computer_voice">ShouldSynchUserRolesInLDAP</span>. If its value is <span class="cv_-_computer_voice">true</span>, the application synchronizes contacts with the roles they belong to after authenticating with the external authentication source.</div>
      <div class="HS_-_Head_Sub"><a name="1855891">Authentication Service Sample Code</a></div>
      <div class="B_-_Body"><a name="1991357">The product includes the following example authentication services in the directory </a><span class="cv_-_computer_voice">ClaimCenter/java-api/</span><span class="cv_-_computer_voice">examples/plugins/authenticationservice</span>. </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="1991378">Default ClaimCenter authentication example.</a></span> This is the basic default service for ClaimCenter provided as source code. It checks the username and password against information stored in the ClaimCenter database and authenticates the user if a match is found.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="1991371">LDAP authentication example.</a></span><span class="cv_-_computer_voice"> LDAPAuthenticationServicePlugin</span> is an example of authenticating against an LDAP directory.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="1991373">JAAS authentication example. </a></span><span class="cv_-_computer_voice">JAASAuthenticationServicePlugin</span> is an example of how you could write a plugin to authenticate against an external repository using JAAS. JAAS is an API that enables Java code to access authentication services without being tied to those services.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1856060">In the JAAS example, the plugin makes a </a><span class="cv_-_computer_voice">context.login</span> method call to the configured JAAS provider. The provider in turn calls back to the <span class="cv_-_computer_voice">JAASCallbackHandler</span> to request credential information needed to make a decision. The plugin provides this callback handler to the JAAS provider. This is a JAAS object, different from the callback handler provided by ClaimCenter to the plugin as a ClaimCenter API. If the user cannot authenticate to JAAS, then the JAAS provider throws an exception. Otherwise, login continues.</div>
      <div class="H3_-_Heading_3"><a name="1855926">SOAP API Limitations</a></div>
      <div class="B_-_Body"><a name="1839142">You cannot use ClaimCenter web service (SOAP) APIs from within authentication plugins. </a></div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="1839146">Do not attempt to use ClaimCenter web service (SOAP) APIs from within authentication </a>plugins because doing so would require authentication. </div>
      <div class="H3_-_Heading_3"><a name="1856130">SOAP API User Permissions and Special-Casing Users</a></div>
      <div class="B_-_Body"><a name="1856134">Guidewire recommends creating a separate ClaimCenter user (or users) for SOAP API access. This user or set of </a>users must have the minimum permissions allowable to perform SOAP API calls. Guidewire strongly recommends that this user have few permissions or no permissions in the web application user interface.</div>
      <div class="B_-_Body"><a name="1856135">From an authentication service plugin perspective, you could create an exception list in your authentication </a>plugin to implement ClaimCenter internal authentication for only those users. For other users, use LDAP or some other authentication service.</div>
      <div class="H2_-_Heading_2"><a name="1454359">Example Authentication Service ‘Authenticate’ Method</a></div>
      <div class="B_-_Body"><a name="1454363">The following sample shows how to verify a user name and password against the ClaimCenter database and then </a>modify the user’s information as part of the login process. </div>
      <PRE class="CF_-_Code_First_Line"><a name="1454364">public String authenticate(AuthenticationSource source) throws LoginException</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454365">{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454366">if (source instanceof UserNamePasswordAuthenticationSource == false) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454367">    throw new IllegalArgumentException("Authentication source type " + </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454368">   source.getClass().getName() + " is not known to this plugin");</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454369">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454370">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454371"> Assert.check(_handler != null ? null : "Callback handler not set");</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454372">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454373"> UserNamePasswordAuthenticationSource uNameSource = (UserNamePasswordAuthenticationSource) source;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454374">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454375"> Hashtable env = new Hashtable();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454376">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454377"> env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.ldap.LdapCtxFactory");</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454378"> env.put(Context.PROVIDER_URL, "LDAP://" + _serverName + ":" + _serverPort);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454379"> env.put(Context.SECURITY_AUTHENTICATION, "simple");</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454380"> String userName = uNameSource.getUsername();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454381"> if (StringUtils.isNotBlank(_domainName)) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454382">   userName = _domainName + "\\" + userName;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454383"> }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454384">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454385"> env.put(Context.SECURITY_PRINCIPAL, userName);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454386"> env.put(Context.SECURITY_CREDENTIALS, uNameSource.getPassword());</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454387">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454388"> try {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454389">   // Try to login.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454390">   new InitialDirContext(env);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454391">&nbsp;</a>&nbsp;&nbsp;// Here would could get the result to the earlier and </PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1471674">&nbsp;</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify the user in some way if you needed to</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454392">&nbsp;</a>&nbsp;&nbsp;} catch (NamingException e) {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454393">     throw new LoginException(e.getMessage());</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454394">&nbsp;</a>&nbsp;}</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454395">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454396"> String username = uNameSource.getUsername();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454397"> String userPublicId = _handler.findUser(username);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454398"> if (userPublicId == null) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454399">   throw new FailedLoginException("Bad user name " + username);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454400">}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1454401">&nbsp;</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="1454402">return userPublicId;</a></PRE>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>