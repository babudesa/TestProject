<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Implementing Messaging Plugins</title>
    <link rel="StyleSheet" href="css/eventsmessaging.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>ClaimCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="eventsmessaging.10.01.html#3807598">Messaging and Events</a> : Implementing Messaging Plugins</span></div>
    <hr align="left" />
    <blockquote>
      <div class="H1_-_Heading_1"><a name="3807598">Implementing Messaging Plugins</a></div>
      <div class="B_-_Body"><a name="3110418">There are three types of messaging plugins. See the following sections for details:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.12.html#3110432', '');" title="Implementing Messaging Plugins" name="3110422">“Implementing a Message Request Plugin”</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.12.html#3715746', '');" title="Implementing Messaging Plugins" name="3110426">“Implementing a Message Transport Plugin”</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.12.html#3110489', '');" title="Implementing Messaging Plugins" name="3110430">“Implementing a Message Reply Plugin”</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="4237314">Event Fired rules and messaging plugin implementations have limitations about what data </a>you can change. See <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.02.html#4210337', '');" title="Messaging Overview">“Entity Data Restrictions in Messaging Rules and Messaging Plugins”</a>.</div>
      <div class="B_-_Body"><a name="3715750">For all three types, your implementations of messaging plugins must explicitly implement </a><span class="cv_-_computer_voice">InitializablePlugin</span> in the class definition. This interface tells the application that you support the <span class="cv_-_computer_voice">setParameters</span> method to get parameters from the plugin registry. If you do not already have this defined explicitly, you must also implement <span class="cv_-_computer_voice">InitializablePlugin</span> or the application does not initialize your messaging plugin.</div>
      <div class="B_-_Body"><a name="3715751">For example, suppose your plugin implementation’s first line looks like this:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715752">class MyTransport implements MessageTransport {</a></PRE>
      <div class="B_-_Body"><a name="3715753">Change it to this:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715755">class MyTransport implements MessageTransport, InitializablePlugin {</a></PRE>
      <div class="B_-_Body"><a name="3715756">To conform to this new interface, add a </a><span class="cv_-_computer_voice">setParameters</span> method even if you do not need parameters from the plugin registry:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715757">function setParameters(map: java.util.Map)  { // this is part of InitializablePlugin</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715758">&nbsp;</a>&nbsp;&nbsp;&nbsp;</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715759">&nbsp;</a>&nbsp;&nbsp;&nbsp;// access values in the MAP to get parameters defined in plugin registry in Studio</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715760">&nbsp;</a>&nbsp;&nbsp;&nbsp;</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3760921">&nbsp;</a>&nbsp;&nbsp;var myVar = map["MyKeyName"]</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715761">   }</a></PRE>
      <div class="H2_-_Heading_2"><a name="3110432">Implementing a Message Request Plugin</a></div>
      <div class="B_-_Body"><a name="3110435">A destination can optionally define a message request (</a><span class="cv_-_computer_voice">MessageRequest</span>) plugin to prepare a <span class="cv_-_computer_voice">Message</span> object before a message is sent to the message transport. It may not be necessary to do this step. For example, if textual message payload contains strings or codes that must be translated for a specific remote system. Or perhaps a textual message payload contains simple name/value pairs that must be translated into a XML before sending to the message transport. Or, perhaps you need to set data model extension properties on <span class="cv_-_computer_voice">Message</span>.</div>
      <div class="B_-_Body"><a name="3110438">To prepare a message before sending, implement the </a><span class="cv_-_computer_voice">MessageRequest</span> method <span class="cv_-_computer_voice">beforeSend</span>. ClaimCenter calls this method with the message entity (a <span class="cv_-_computer_voice">Message</span>). </div>
      <div class="B_-_Body"><a name="3758552">The main task for this method is to generate a modified payload and return it from the method. Generally </a>speaking, do <span class="s_-_strong">not</span> modify the payload directly in the <span class="cv_-_computer_voice">Message</span> entity. The result from this method passes to the messaging transport plugin to send in its <span class="cv_-_computer_voice">transformedPayload</span> parameter. This transformed payload parameter is separate from the <span class="cv_-_computer_voice">Message</span> entity that the message transport plugin gets as a parameter.</div>
      <div class="B_-_Body"><a name="3758551">You can modify properties within the </a><span class="cv_-_computer_voice">Message</span> or within the message’s root object such as a <span class="cv_-_computer_voice">Claim</span> object as needed. However, as mentioned before, to transform the payload just return a String value from the method rather than modifying the <span class="cv_-_computer_voice">Message</span>.</div>
      <div class="B_-_Body"><a name="3110446">You can also use the </a><span class="cv_-_computer_voice">MessageRequest</span> plugin to perform post-sending processing on the message. To perform this type of action, implement the <span class="cv_-_computer_voice">MessageRequest</span> method <span class="cv_-_computer_voice">afterSend</span>. ClaimCenter calls the method with the message (a <span class="cv_-_computer_voice">Message</span> object) as a parameter. ClaimCenter calls this method <span class="e_-_emphasis">immediately</span> after the transport plugin’s <span class="cv_-_computer_voice">send</span> method completes. If you implement asynchronous callbacks with a message reply plugin, be sure to understand that the server calls <span class="cv_-_computer_voice">afterSend</span> in the same thread executing the plugin’s <span class="cv_-_computer_voice">send</span> method. However, it might be a separate thread from any asynchronous callback code.</div>
      <div class="B_-_Body"><a name="4125080">Also, if the </a><span class="cv_-_computer_voice">send</span> method acknowledges the message with any result (successful Ack or an error), then be aware that the Ack does not affect whether the application calls <span class="cv_-_computer_voice">afterSend</span>. Assuming no exceptions trigger during calls to <span class="cv_-_computer_voice">beforeSend</span> or <span class="cv_-_computer_voice">send</span>, ClaimCenter calls the <span class="cv_-_computer_voice">afterSend</span> method.</div>
      <div class="H2_-_Heading_2"><a name="3715746">Implementing a Message Transport Plugin</a></div>
      <div class="B_-_Body"><a name="3110464">A destination </a><span class="s_-_strong">must</span> define a message transport (<span class="cv_-_computer_voice">MessageTransport</span>) plugin to send a <span class="cv_-_computer_voice">Message</span> object over some physical or abstract transport. This might involve submitting a message to a message queue, calling a remote web service API, or might implement a complex proprietary protocol specific to some remote system. The message transport plugin is the only required plugin interface for a destination.</div>
      <div class="B_-_Body"><a name="3110467">To send a message, implement the </a><span class="cv_-_computer_voice">send</span> method, which ClaimCenter calls with the message (a <span class="cv_-_computer_voice">Message</span> object). That method has another argument, which is the <span class="e_-_emphasis">transformed payload</span> if that destination implemented a message request plugin. See <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.12.html#3110432', '');" title="Implementing Messaging Plugins">“Implementing a Message Request Plugin”</a>.</div>
      <div class="B_-_Body"><a name="3115403">In the message transport plugin’s simplest form, this method does its work synchronously entirely in the </a><span class="cv_-_computer_voice">send</span> method. For example, call a single remote API call such as an outgoing web service request on a legacy computer. Your <span class="cv_-_computer_voice">send</span> method optionally can immediately acknowledge the message with the code <span class="cv_-_computer_voice">message.reportAck(...)</span>. If there are errors, instead use the message methods <span class="cv_-_computer_voice">reportError</span> and <span class="cv_-_computer_voice">reportNonRetryableError</span>. To report a duplicate message, use <span class="cv_-_computer_voice">reportDuplicate</span>, which is a method not on the current message but on the <span class="cv_-_computer_voice">MessageHistory</span> entity that represents the original message.</div>
      <div class="B_-_Body"><a name="3110476">If you must acknowledge the message synchronously, your </a><span class="cv_-_computer_voice">send</span> method may optionally update properties on ClaimCenter objects such as <span class="cv_-_computer_voice">Claim</span>. If you desire this, you can get the message root object by getting the property <span class="ps_-_parameter_in_code_snippets">theMessage</span><span class="cv_-_computer_voice">.MessageRoot</span>. Changes to the message and any other modified entities persist to the database after the <span class="cv_-_computer_voice">send</span> method completes. Changes also persist after the <span class="cv_-_computer_voice">MessageRequest</span> plugin completes work in its <span class="cv_-_computer_voice">afterSend</span> method. To visualize how these elements interact, see the diagram in <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.03.html#3006454', '');" title="Message Destination Overview">“Message Destination Overview”</a>.</div>
      <div class="B_-_Body"><a name="3115429">If your message transport plugin </a><span class="cv_-_computer_voice">send</span> method does not synchronously acknowledge the message before returning, then this destination must also implement the message reply plugin. The message reply plugin to handle the asynchronous reply. See the <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.12.html#3110489', '');" title="Implementing Messaging Plugins">“Implementing a Message Reply Plugin”</a> for details.</div>
      <div class="B_-_Body"><a name="3110480">You must handle the possibility of receiving duplicate message notifications from your external systems. </a>Usually, the receiving system detects duplicate messages by tracking the message ID, and returns an appropriate status message. The plugin code that receives the reply messages can call the <span class="ps_-_parameter_in_code_snippets">message</span><span class="cv_-_computer_voice">.reportDuplicate()</span> method. Depending on the implementation, the code that receives the reply would be either the message transport plugin or the message reply plugin. Your code that detects the duplicate must skip further processing or acknowledgement for that message.</div>
      <div class="B_-_Body"><a name="3758637">Your implementations of messaging plugins must explicitly implement </a><span class="cv_-_computer_voice">InitializablePlugin</span> in the class definition. This interface tells ClaimCenter that you support the <span class="cv_-_computer_voice">setParameters</span> method to get parameters from the plugin registry. Even if you do not need parameters, your plugin implementation must implement <span class="cv_-_computer_voice">InitializablePlugin</span> or the application does not initialize your messaging plugin.</div>
      <div class="B_-_Body"><a name="3715799">Your implementation of this plugin must explicitly implement </a><span class="cv_-_computer_voice">InitializablePlugin</span> in the class definition and then also add a <span class="cv_-_computer_voice">setParameters</span> method to get parameters. Implement this interface even if you do <span class="s_-_strong">not</span> need the parameters from the plugin registry.</div>
      <div class="B_-_Body"><a name="3752002">The following example in Java demonstrates a basic message transport.</a></div>
      <div class="HS_-_Head_Sub"><a name="3115384">Example Basic Message Transport For Testing</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715648">uses java.util.Map;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715649">uses java.plugin;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715650">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715652">class MyTransport implements MessageTransport, InitializablePlugin {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715653">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715654">&nbsp;</a>&nbsp;&nbsp;// note the empty constructor. The application now longer calls the constructor</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715655">&nbsp;</a>&nbsp;&nbsp;// with a map of parameters. If you do provide an empty constructor, the application</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715656">&nbsp;</a>&nbsp;&nbsp;// calls it if making an instance of the plugin, which is before calling setParameters</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715657">   construct()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715658">   {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715659">   }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715660">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715661">   function setParameters(map: java.util.Map)  { // this is part of InitializablePlugin</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715662">&nbsp;</a>&nbsp;&nbsp;&nbsp;</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715663">&nbsp;</a>&nbsp;&nbsp;&nbsp;// access values in the MAP to get parameters defined in plugin registry in Studio</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715664">&nbsp;</a>&nbsp;&nbsp;&nbsp;</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715665">   }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715666">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715667">&nbsp;</a>&nbsp;// NEXT, define all your other methods required by the MAIN interface you are implementing...</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715668">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715669">   function suspend() {}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715670">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715671">   function shutdown() {}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715672">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715673">   function setDestinationID(id:int) {}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715674">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715675">   function resume() {}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715676">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715677">   function send(message:entity.Message, transformedPayload:String) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715678">     print("======================================================")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715679">     print(message)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715680">     message.reportAck()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715681">   }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3715682">}</a></PRE>
      <div class="HS_-_Head_Sub"><a name="3715646">More Examples</a></div>
      <div class="B_-_Body"><a name="3715642">Several example message transport plugins ship with ClaimCenter in the product. Refer to these directories:</a></div>
      <div class="CS_-_Code_Single_Line"><a name="4125198">ClaimCenter/java-api/examples/src/examples/plugins/messaging</a></div>
      <div class="CS_-_Code_Single_Line"><a name="4125138">ClaimCenter/java-api/examples/src/com/guidewire/cc/plugin/messaging</a></div>
      <div class="HS_-_Head_Sub"><a name="3110483">Exception Handling</a></div>
      <div class="B_-_Body"><a name="3110486">For details of exceptions and handling suspect/shutdown in messaging plugins, see </a><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.12.html#3138748', '');" title="Implementing Messaging Plugins">“Error Handling in Messaging Plugins”</a>.</div>
      <div class="H2_-_Heading_2"><a name="3110489">Implementing a Message Reply Plugin</a></div>
      <div class="B_-_Body"><a name="3110491">A destination can optionally define a message reply (</a><span class="cv_-_computer_voice">MessageReply</span>) plugin to asynchronously acknowledge a <span class="cv_-_computer_voice">Message</span>. For instance, this plugin might implement a “trigger” from an external system to notify ClaimCenter that the message send succeeded or failed.</div>
      <div class="B_-_Body"><a name="3110502">ClaimCenter requires a special step in this process to setup the ClaimCenter database transaction information </a>appropriately so that any entity changes commit to the ClaimCenter database. To do this properly, Guidewire provides the classes and interfaces called <span class="cv_-_computer_voice">MessageFinder</span>, <span class="cv_-_computer_voice">PluginCallbackHandler</span>, and the inner interface called <span class="cv_-_computer_voice">PluginCallbackHandler.Block</span>.</div>
      <div class="B_-_Body"><a name="3110512">A message finder </a><span class="cv_-_computer_voice">(MessageFinder)</span> object is built-in object that returns a <span class="cv_-_computer_voice">Message</span> object from its <span class="cv_-_computer_voice">messageID</span> or <span class="cv_-_computer_voice">senderRefID</span>, using its <span class="cv_-_computer_voice">findById</span> or <span class="cv_-_computer_voice">findBySendRefId</span> method, respectively. During the message reply plugin initialization phase, ClaimCenter calls the message reply plugin’s <span class="cv_-_computer_voice">initTools</span> method with an instance of <span class="cv_-_computer_voice">MessageFinder</span>. Save this instance of <span class="cv_-_computer_voice">MessageFinder</span> in a private variable within the plugin instance.</div>
      <div class="B_-_Body"><a name="3110522">A plugin callback handler (</a><span class="cv_-_computer_voice">PluginCallbackHandler</span>) is an object provided to a message reply plugin. The callback handler safely executes the message reply callback code block. The callback handler sets up the callback’s server thread and the database transaction information so entity changes safely and consistently save to the database.</div>
      <div class="B_-_Body"><a name="3715803">Your implementation of this plugins must explicitly implement </a><span class="cv_-_computer_voice">InitializablePlugin</span> in the class definition and then also add a <span class="cv_-_computer_voice">setParameters</span> method to get parameters. Implement this interface even if you do <span class="s_-_strong">not</span> need the parameters from the plugin registry.</div>
      <div class="B_-_Body"><a name="4069013">For important information about using message finders to submit errors and duplicates, see </a><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.12.html#3138748', '');" title="Implementing Messaging Plugins">“Error Handling in Messaging Plugins”</a>.</div>
      <div class="H3_-_Heading_3"><a name="3114855">Message Reply Plugin Initialization</a></div>
      <div class="B_-_Body"><a name="3114856">During initialization, the message reply plugin must get and store a reference to the message finder </a>(<span class="cv_-_computer_voice">MessageFinder</span>) and callback handler (<span class="cv_-_computer_voice">PluginCallbackHandler</span>) objects, since it needs to use them later.</div>
      <div class="B_-_Body"><a name="3114859">There are two ways of doing this:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="3114861">Using MessageReply.</a></span> If you use the simple <span class="cv_-_computer_voice">MessageReply</span> interface, you must implement the <span class="cv_-_computer_voice">initTools</span> method which gets these objects as parameters. The plugin can store these values in private properties such as <span class="cv_-_computer_voice">_pluginCallbackHandler</span> and <span class="cv_-_computer_voice">_messageFinder</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="3114865">Using MessageReplyBase.</a></span> Alternatively, you can base your implementation on <span class="cv_-_computer_voice">MessageReplyBase</span>, which implements the <span class="cv_-_computer_voice">MessageReply</span> interface. <span class="cv_-_computer_voice">MessageReplyBase</span> automatically implements the <span class="cv_-_computer_voice">initTools</span> method and stores those values in private variables <span class="cv_-_computer_voice">_pluginCallbackHandler</span> and <span class="cv_-_computer_voice">_messageFinder</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="H3_-_Heading_3"><a name="3114853">Message Reply Callbacks</a></div>
      <div class="B_-_Body"><a name="3110535">To acknowledge the message asynchronously, the message reply plugin uses its reference to the </a><span class="cv_-_computer_voice">PluginCallbackHandler</span>. The plugin passes a specially-prepared block of Java code to the <span class="cv_-_computer_voice">PluginCallbackHandler</span> method called <span class="cv_-_computer_voice">execute</span>. </div>
      <div class="B_-_Body"><a name="3762335">The </a><span class="cv_-_computer_voice">execute</span> method takes a message reply callback block, which is an instance of <span class="cv_-_computer_voice">PluginCallbackHandler.Block.</span> The <span class="cv_-_computer_voice">Block</span> is a simple private interface to encapsulate the block of code that you write.</div>
      <div class="B_-_Body"><a name="3110545">The </a><span class="cv_-_computer_voice">PluginCallbackHandler</span> object also has an <span class="cv_-_computer_voice">add</span> method that can mark a ClaimCenter entity as potentially modified so it can commit to the database with the Ack. Call the <span class="cv_-_computer_voice">add</span> method with an entity to ensure that changes to that entity commit to the database in the correct database transaction. This adds the entity to the correct <span class="e_-_emphasis">bundle</span>. For more about bundles, see <a href="javascript:WWHClickedPopup('gosu', 'transactions.21.1.html#1456387', '');" title="Bundles and Transactions">“Bundles and Transactions” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'transactions.21.1.html#1456387', '');" title="Bundles and Transactions">Gosu Reference Guide</a></span>.</div>
      <div class="B_-_Body"><a name="3110547">Your code in </a><span class="cv_-_computer_voice">PluginCallbackHandler.Block</span> must perform the following steps:</div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><a name="3110550">Get a </a><span class="cv_-_computer_voice">Message</span> object from methods on the plugin’s <span class="cv_-_computer_voice">MessageFinder</span> instance, described earlier in this section.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3110554">Call methods on the </a><span class="cv_-_computer_voice">Message</span> to signal acknowledgement or errors. For example, report success with <span class="cv_-_computer_voice">message.reportAck()</span>. If there are errors or duplicates, use <span class="cv_-_computer_voice">message.reportError</span>, <span class="cv_-_computer_voice">message</span>.<span class="cv_-_computer_voice">reportNonRetryableError</span>, and <span class="cv_-_computer_voice">message.reportDuplicate</span>. For more information about acknowledgements, see <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.10.html#3247056', '');" title="Reporting Acknowledgements and Errors">“Submitting Acks and Errors and Duplicates from Your Messaging Plugin”</a>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3110555">Optional post-processing such as property updates or triggering custom events. If any objects must be modi</a>fied other than the objects originally attached to the message, the callback block must call <span class="cv_-_computer_voice">PluginCallbackHandler.add(</span><span class="ps_-_parameter_in_code_snippets">entityReference</span><span class="cv_-_computer_voice">)</span>. This call to the <span class="cv_-_computer_voice">add</span> method ensures all changes on the other objects properly commit to the database as part of that database transaction.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3114850">For example, the following example demonstrates creating a </a><span class="cv_-_computer_voice">PluginCallbackHandler.Block</span> object and executing the callback block. </div>
      <PRE class="CF_-_Code_First_Line"><a name="3110564">...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110565">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110566">PluginCallbackHandler.Block block = new PluginCallbackHandler.Block() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110567">        public void run() throws Throwable {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110568">          Message message = _messageFinder.findById(messageID);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110569">          message.reportAck();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110570">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110571">      };</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110572"> </a>&nbsp;</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110573">_pluginCallbackHandler.execute(block);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110574">&nbsp;</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="3110575">...</a></PRE>
      <div class="B_-_Body"><a name="3715976">You can call </a><span class="cv_-_computer_voice">EntityFactory</span> as necessary in your callback handler block to create or find entities. The application properly sets up the thread context so that it supports <span class="cv_-_computer_voice">EntityFactory</span>. For more information about <span class="cv_-_computer_voice">EntityFactory</span>, see <a href="javascript:WWHClickedPopup('gosu', 'java-gosu.08.06.html#2073753', '');" title="Java Entity Libraries Overview">“Java Entity Libraries Overview” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'java-gosu.08.06.html#2073753', '');" title="Java Entity Libraries Overview">Gosu Reference Guide</a></span>.</div>
      <div class="HS_-_Head_Sub"><a name="3110576">Example Message Reply Plugin </a></div>
      <div class="B_-_Body"><a name="3752087">The following code illustrates a simple abstract message reply plugin that listens for an acknowledgement to a </a>recent message send request. This example plugin registers an incoming message queue from which it pulls future responses from the remote destination system. If the plugin detects a response from this queue, it acknowledges the message with the <span class="cv_-_computer_voice">message.reportAck()</span> method.</div>
      <PRE class="CF_-_Code_First_Line"><a name="3114922">package examples.plugins.messaging;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114923">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114924">import com.guidewire.cc.external.entity.Message;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114925">import com.guidewire.cc.plugin.messaging.MessageFinder;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114926">import com.guidewire.cc.plugin.messaging.MessageReply;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114927">import com.guidewire.cc.plugin.messaging.MessageReplyBase;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114928">import com.guidewire.pl.plugin.PluginCallbackHandler;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114929">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114930">import java.util.Map;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114931">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114932">/**</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114933"> * Sample implementation of the MessageReply plugin interface that shows</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114934"> * how to acknowledge a message from an asynchronous reply.  Registers</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114935"> * a listener to be called whenever a message posts to</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114936"> * a simulated asynchronous queue.  If your listener get a message,</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114937"> * use the PluginCallbackHandler and MessageFinder instances to</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114938"> * look up and acknowledge the message.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114939"> */</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114940">public class MessageReplyImpl extends MessageReplyBase {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114941">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114942">  public void setParameters(Map params) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114943">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114944">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114945">  public void shutdown() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114946">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114947">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114948">  public void suspend() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114949">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114950">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114951">  public void resume() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114952">    // Start listening on the queue.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114953">    QueueSimulator.getInstance().listen(new MyQueueListener());</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114954">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114955">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114956">  public void setDestinationID(int destinationID) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114957">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114958">  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114959">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114960">  /**</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114961">   * Implementation of QueueListener that listens for messages to be posted</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114962">   * to the queue and acks them.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114963">   */</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114964">  private class MyQueueListener implements QueueListener {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114965">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114966">    /**</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114967">     * Called if a message inserts in the queue.  Looks up the message</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114968">     * and acks it using the PluginCallbackHandler instance supplied while </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114969">     * creating and initializing the plugin.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114970">     *</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114971">     * @param messageID</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114972">     */</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114973">    public void responseReceived(final int messageID) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3115138">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3115139">&nbsp;</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// IMPORTANT: this method relies on the private variables _messageFinder</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3115144">&nbsp;</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and _messageFinder, which are set by the superclass MessageReplyBase</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3115155">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114974">      PluginCallbackHandler.Block block = new PluginCallbackHandler.Block() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114975">        public void run() throws Throwable {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114976">          Message message = _messageFinder.findById(messageID);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114977">          message.reportAck();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114978">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114979">      };</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114980">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114981">      try {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114982">        _pluginCallbackHandler.execute(block);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114983">      } catch (Throwable throwable) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114984">        throwable.printStackTrace();  // In the real world, log this at least.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114985">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114986">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3114987">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110604">}</a></PRE>
      <div class="B_-_Body"><a name="3115068">You can find the complete sample code (including the queue simulator) in the product at the path:</a></div>
      <div class="B_-_Body"><a name="4125277">Several example message transport plugins ship with ClaimCenter in the product. Refer to these directories:</a></div>
      <div class="CS_-_Code_Single_Line"><a name="4125281">ClaimCenter/java-api/examples/src/examples/plugins/messaging</a></div>
      <div class="CS_-_Code_Single_Line"><a name="4125288">ClaimCenter/java-api/examples/src/com/guidewire/cc/plugin/messaging</a></div>
      <div class="B_-_Body"><a name="3115085">This example includes the files </a><span class="cv_-_computer_voice">QueueSimulator.java</span>, <span class="cv_-_computer_voice">MessageReplyImpl.java</span>, <span class="cv_-_computer_voice">MessageRequestImpl.java</span>, <span class="cv_-_computer_voice">QueueListener.java</span>, and <span class="cv_-_computer_voice">MessageTransportImpl.java</span>.</div>
      <div class="HS_-_Head_Sub"><a name="3115039">Exception Handling</a></div>
      <div class="B_-_Body"><a name="3110621">For details of exceptions and handling suspect/shutdown in messaging plugins, see </a><a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.12.html#3138748', '');" title="Implementing Messaging Plugins">“Error Handling in Messaging Plugins”</a>.</div>
      <div class="H2_-_Heading_2"><a name="3138748">Error Handling in Messaging Plugins</a></div>
      <div class="B_-_Body"><a name="3138749">Several methods on messaging plugins execute in a strict order for a message. Consult the following list to </a>design your messaging code, particularly error-handling code: </div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><a name="3138750">ClaimCenter selects a message from the send queue on the batch server.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3752124">If this destination defines a </a><span class="cv_-_computer_voice">MessageRequest</span> plugin, ClaimCenter calls <span class="cv_-_computer_voice">MessageRequest.beforeSend</span>. This method uses the text payload in <span class="cv_-_computer_voice">Message.payload</span> and transforms it and returns the transformed payload. The message transport method uses this transformed message payload later.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3138629">If </a><span class="cv_-_computer_voice">MessageRequest.beforeSend</span> made changes to the <span class="cv_-_computer_voice">Message</span> entity or other entities, ClaimCenter <span class="s_-_strong">commits</span> those changes to the database, assuming that method threw no exceptions. The following special rules apply:</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="3138630">Committing entity changes is important if your integration code must choose among multiple pooled out</a>going messaging queues. If errors occur, to avoid duplicates the message must always resend to the same queue each time. If you require this approach, add a data model extension property to the <span class="cv_-_computer_voice">Message</span> entity to store the queue name. In <span class="cv_-_computer_voice">beforeSend</span> method, choose a queue and set your extension property to the queue name. Then, your main messaging plugin (<span class="cv_-_computer_voice">MessageTransport</span>) uses this property to send the message to the correct queue.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="3138631">If exceptions occur, the application rolls back changes to the database and sets the message to retry later. </a>There is no special exception type that sets the message to&nbsp;retry (an un-retryable error). </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="3249520">In all cases, the application never explicitly commits the transformed payload to the database.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3758922">ClaimCenter calls </a><span class="cv_-_computer_voice">MessageTransport.send(</span><span class="ps_-_parameter_in_code_snippets">message</span><span class="cv_-_computer_voice">, </span><span class="ps_-_parameter_in_code_snippets">transformedPayload</span><span class="cv_-_computer_voice">)</span>. The <span class="cv_-_computer_voice">Message</span> entity can be changed, but the transformed payload parameter is read-only and effectively ephemeral.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3758927">If this destination defines a </a><span class="cv_-_computer_voice">MessageRequest</span> plugin, ClaimCenter calls <span class="cv_-_computer_voice">MessageRequest.afterSend</span>. This method can change the <span class="cv_-_computer_voice">Message</span> if desired.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3138643">Any changes from </a><span class="cv_-_computer_voice">send</span> and <span class="cv_-_computer_voice">afterSend</span> methods (<a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.12.html#3758922', '');" title="Implementing Messaging Plugins">step 4</a> and <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.12.html#3758927', '');" title="Implementing Messaging Plugins">step 5</a>) commit if and only if no exceptions occurred yet. Any exceptions roll back changes to the database and set the message to retry. Be aware there is no special exception class that sets the message <span class="s_-_strong">not</span><span class="s_-_strong">&nbsp;</span><span class="s_-_strong">to</span><span class="s_-_strong">&nbsp;</span><span class="s_-_strong">retry</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	7.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3138644">If this destination defines a </a><span class="cv_-_computer_voice">MessageReply</span> plugin, its callback handler code executes separately to handle asynchronous replies. Any changes to the <span class="cv_-_computer_voice">Message</span> entity or other entities commit to the database after the code completes, assuming the callback throws no exceptions.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3138721">If there are problems with a message, you do not necessarily need to throw an exception in all cases. For </a>example, depending on the business logic of the application, it might be appropriate to <span class="e_-_emphasis">skip</span> the message and notify an administrator. If you need to resume a destination later, you can do that using the web services APIs.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="3247252">All Gosu or Java exceptions mark the message a retryable during the </a><span class="cv_-_computer_voice">send</span> method or from the related <span class="cv_-_computer_voice">beforeSend</span> and <span class="cv_-_computer_voice">afterSend</span> methods. All exceptions at this time imply retryable errors. However, the distinction between retryable errors and non-retryable errors still exists if submitting errors later on in the message’s life cycle. For example, you can mark non-retryable errors while acknowledging messages with web services or in asynchronous replies implemented with the <span class="cv_-_computer_voice">MessageReply</span> plugin.</div>
      <div class="H3_-_Heading_3"><a name="3180071">Submitting Errors</a></div>
      <div class="B_-_Body"><a name="3715964">If there is an error for the message but it can retry more times, call </a><span class="cv_-_computer_voice">message.reportError</span>(...). If there is an error for the message and retrying would not help, call <span class="cv_-_computer_voice">message</span>.<span class="cv_-_computer_voice">reportNonRetryableError</span>(...). See <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.10.html#3247056', '');" title="Reporting Acknowledgements and Errors">“Submitting Acks and Errors and Duplicates from Your Messaging Plugin”</a>.</div>
      <div class="H3_-_Heading_3"><a name="3715971">Handling Duplicates</a></div>
      <div class="B_-_Body"><a name="3710306">Your code must handle the possibility of receiving duplicate messages at the plugin layer or at the external </a>system. Typically the receiving system detects duplicate messages by tracking the message ID and returns an appropriate status message. The plugin code that receives the reply messages can report the duplicate with <span class="cv_-_computer_voice">message.reportDuplicate()</span> and skip further processing. </div>
      <div class="B_-_Body"><a name="4087484">Depending on the implementation, your code that receives the reply messages is either within the </a><span class="cv_-_computer_voice">MessageTransport.send() method </span>or in your <span class="cv_-_computer_voice">MessageReply</span> plugin. For more information about acknowledgements and errors, see <a href="javascript:WWHClickedPopup('integration', 'eventsmessaging.10.10.html#3247056', '');" title="Reporting Acknowledgements and Errors">“Submitting Acks and Errors and Duplicates from Your Messaging Plugin”</a>.</div>
      <div class="H3_-_Heading_3"><a name="3760521">Saving the Destination ID for Logging or Errors</a></div>
      <div class="B_-_Body"><a name="3760522">Each messaging plugin implementation must have a </a><span class="cv_-_computer_voice">setDestinationID</span> method, which allows the plugin to find out its own destination ID and store it in a private variable. The destination can use the destination ID within code such as:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3752343">Logging code to record the destination ID.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3752344">Exception-handling code that works differently for each destination.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3752351">Other integrations, such as sending destination ID to external systems so that they can suspend/resume the </a>destination if necessary.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="H2_-_Heading_2"><a name="3110658">Handling Messaging Destination Suspend, Resume, Shutdown</a></div>
      <div class="B_-_Body"><a name="3623282">The standard messaging plugins have methods that perform special actions for the administrative commands for </a>destination suspend, destination resume, and before messaging system shutdown.</div>
      <div class="B_-_Body"><a name="3710358">Typically, suspend and resume is the result of an administrator using the </a><span class="ui_-_UI_element">Administration</span> tab in the user interface to suspend or resume a messaging destination. Alternatively, suspend and resume could be the result of a web service API call to suspend or resume destinations.</div>
      <div class="B_-_Body"><a name="3710359">Messaging shut down occurs during server shutdown or if the configuration is about to be reread. After message </a>sending resumes again, ClaimCenter reuses the same <span class="e_-_emphasis">instance</span> of the plugin. ClaimCenter does not destroy the existing messaging plugin instance (or recreate it) as part of shutdown. </div>
      <div class="B_-_Body"><a name="3623314">To trap these actions, implement the </a><span class="cv_-_computer_voice">suspend</span>, <span class="cv_-_computer_voice">shutdown</span>, and <span class="cv_-_computer_voice">resume</span> methods of your messaging plugin.</div>
      <div class="B_-_Body"><a name="3110665">You can implement these methods just for logging and notification, if nothing else. For example, a message </a>transport plugin’s <span class="cv_-_computer_voice">suspend</span> or <span class="cv_-_computer_voice">shutdown</span> methods could log the action and send notifications as appropriate. For example:</div>
      <PRE class="CF_-_Code_First_Line"><a name="3110666">public void suspend() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110667">&nbsp;</a>&nbsp;...</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110668">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110669">&nbsp;</a>&nbsp;if(_logger.isDebugEnabled()) {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110670">&nbsp;</a>&nbsp;&nbsp;&nbsp;_logger.debug("Suspending JMS message transport plugin.")</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110671">&nbsp;</a>&nbsp;}</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110672">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3110673">&nbsp;</a>&nbsp;MyEmailHelperClass.sendEmail(".....")</PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="3110674">}</a></PRE>
      <div class="B_-_Body"><a name="3222194">During the </a><span class="cv_-_computer_voice">suspend</span>, <span class="cv_-_computer_voice">shutdown</span>, and <span class="cv_-_computer_voice">resume</span> methods of the plugin, the plugin must <span class="s_-_strong">not</span> call any ClaimCenter <span class="cv_-_computer_voice">IMessageToolsAPI</span> web service APIs that suspend or resume messaging destinations. Doing so creates circular application logic, so such actions are forbidden.</div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="3222234">A messaging plugin </a><span class="cv_-_computer_voice">suspend</span>, <span class="cv_-_computer_voice">shutdown</span>, and <span class="cv_-_computer_voice">resume</span> method must not use messaging web service APIs that suspend or resume messaging destinations.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>