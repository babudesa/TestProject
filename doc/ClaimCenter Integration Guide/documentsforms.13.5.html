<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Generating Documents from Gosu</title>
    <link rel="StyleSheet" href="css/documentsforms.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>ClaimCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="documentsforms.13.1.html#2123542">Document Management</a> : Generating Documents from Gosu</span></div>
    <hr align="left" />
    <blockquote>
      <div class="H1_-_Heading_1"><a name="2123542">Generating Documents from Gosu</a></div>
      <div class="B_-_Body"><a name="2123547">ClaimCenter can generate PDF and Gosu-based forms without user intervention from Gosu business rules or </a>from any other place Gosu runs. </div>
      <div class="B_-_Body"><a name="1852816">ClaimCenter automatic form generation does not support Microsoft Word template, Excel templates, or client-</a>side PDF creation. In all these cases, the document production plugin returns JScript that runs on the user’s computer to generate the new document locally. While business rules run, it is possible no user is logged into the application user interface. Because there may be no client to run the client-side code, client-side document production is impossible for automatic document creation.</div>
      <div class="B_-_Body"><a name="1908759">However, most Word documents convert to the text-based RTF format and many Excel templates can convert to </a>CSV files. Therefore, most Microsoft documents can convert into equivalent Gosu templates that can generate text. You can also use Gosu to generate any other text-based format, most notably plain text and HTML.</div>
      <div class="B_-_Body"><a name="1452188">The automatic form generation process is very similar to the manual document generation process, but effec</a>tively skips some steps previously described for manual form generation. </div>
      <div class="B_-_Body"><a name="1882889">The following list describes differences in automatic form generation compared to steps in </a><a href="javascript:WWHClickedPopup('integration', 'documentsforms.13.3.html#2121312', '');" title="Document Production">“Document Production”</a>. See that section for the step numbers:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="1729048">Automatic template choosing.</a></span> Because template choosing is automatic, this effectively skips <a href="javascript:WWHClickedPopup('integration', 'documentsforms.13.3.html#1881688', '');" title="Document Production">step 1</a> through <a href="javascript:WWHClickedPopup('integration', 'documentsforms.13.3.html#2102572', '');" title="Document Production">step 6</a>. Instead, you specify the appropriate template and parameter information within Gosu code.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="1647739">No user editing.</a></span> Since there is no user intervention, there is no optional step for user intervention within the middle of this flow of <a href="javascript:WWHClickedPopup('integration', 'documentsforms.13.3.html#1897723', '');" title="Document Production">step 9</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="ri_-_run_in_header"><a name="1729031">No user uploading.</a></span> Because the Gosu code is executed on the ClaimCenter server, there is no user uploading step, which is <a href="javascript:WWHClickedPopup('integration', 'documentsforms.13.3.html#1881728', '');" title="Document Production">step 11</a> in that section. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1452192">To create a document, first create a map of values that specifies the value for each context object. Using </a><span class="cv_-_computer_voice">java.util.HashMap</span> is recommended, but any <span class="cv_-_computer_voice">Map</span> type is legal. This value map must be non-<span class="cv_-_computer_voice">null</span>. The values in this map are unconstrained by either the default object value or the possible object values. Be careful to pass valid objects of the correct type.</div>
      <div class="B_-_Body"><a name="1883034">Within business rules, the Gosu class that handles document production is called </a><span class="cv_-_computer_voice">DocumentProduction</span>. It has methods for synchronous or asynchronous creation, which call the respective synchronous or asynchronous methods of the appropriate document production plugin, <span class="cv_-_computer_voice">createDocumentSynchronously</span> or <span class="cv_-_computer_voice">createDocumentAsynchronously</span>. Additionally there is a method to store the document: <span class="cv_-_computer_voice">createAndStoreDocumentSynchronously</span>. You can modify this Gosu class as needed.</div>
      <div class="B_-_Body"><a name="2100821">If synchronous document creation fails, the </a><span class="cv_-_computer_voice">DocumentProduction</span> class throws an exception, which can be caught and handled appropriately by the caller. If document storage errors happen later, such as for asynchronous document storage, the <span class="e_-_emphasis">document content storage plugin</span> must handle errors appropriately. For example, the plugin could send administrative e-mails or create new activities using SOAP APIs to investigate the issues. Or you could design a system to track document creation errors and document management problems in a separate user interface for administrators. In the latter case, the plugin could register any document creation errors with that system.</div>
      <div class="B_-_Body"><a name="2150251">If the synchronous document creation succeeds, next your code must attach the document to the claim by setting </a><span class="cv_-_computer_voice">Document.Claim</span>.</div>
      <div class="B_-_Body"><a name="2121470">The new document uses the latest in-memory entity at the time the rule </a><span class="s_-_strong">runs</span>, not the persisted stored database version of the entity.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2121471">The new document always uses the latest in-memory entity at the time the rule runs. </a>Remember that this may be different from the persisted version.</div>
      <div class="B_-_Body"><a name="2121472">Be careful creating documents within Pre-Update business rules or in other cases where changes can be rolled </a>back due to errors (Gosu exceptions) or validation problems. If errors occur that <span class="e_-_emphasis">roll back</span> the database transaction even though rules added a document an external document management system, the externally-stored document is <span class="e_-_emphasis">orphaned</span>. The document exists in the external system but no ClaimCenter persisted data links to it. On a related note, see <a href="javascript:WWHClickedPopup('integration', 'documentsforms.13.5.html#2083659', '');" title="Generating Documents from Gosu">“Cached Document UIDs”</a>.</div>
      <div class="HS_-_Head_Sub"><a name="2121479">Example Document Creation After Sending an Email</a></div>
      <div class="B_-_Body"><a name="2121480">You can use code like the following to send a standard email and then create a corresponding document:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121481">// First, construct the email</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2150824">var toContact : Contact = myClaim.Insured</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2150825">var fromContact : Contact = myClaim.AssignedUser.Contact.Person</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121487">var subject : String = "Email Subject"</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121488">var body : String = "Email Body"</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121489"> </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121490">// Next, actually *send* the email</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121494">gw.api.email.EmailUtil.sendEmailWithBody(myClaim,</a><span class="cv_-_computer_voice"> </span>toContact, fromContact, subject, body)</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121495"> </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121496">// Next, create the document that records the email</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121500">var document : Document = new Document(myClaim)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2150268">document.Claim = myClaim</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121509">document.Name = "Create by a Rule"</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121510">document.Type = "letter_sent"</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121511">document.Status = "draft"</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121512">// ...perhaps add more property settings here</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121513">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121515">// Create some "context objects"</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121516">var parameters = new java.util.HashMap()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121517">parameters.put("To", toContact)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121518">parameters.put("From", fromContact)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121519">parameters.put("Subject", subject)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121520">parameters.put("Body", body)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121524">parameters.put("RelatedTo", myClaim)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121531">parameters.put("Claim", myClaim)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121532">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121533">// Create and store the document using the context objects</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2121536">DocumentProduction.createAndStoreDocumentSynchronously("EmailSent.gosu.htm",</a>&nbsp;parameters, document)</PRE>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="2145373">For more examples of creating documents from Gosu, see </a><a href="javascript:WWHClickedPopup('rules', 'rules_documentcreation.17.1.html#2981402', '');" title="Document Creation">“Document Creation” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('rules', 'rules_documentcreation.17.1.html#2981402', '');" title="Document Creation">Rules Guide</a></span>.</div>
      <div class="B_-_Body"><a name="1887264">This particular example assumes that the document production plugin for that template supports synchronous </a>production. This is true for all built-in document production plugins but not necessarily for all document production plugins. The calling code must either know in advance whether the document production plugin for that template type supports synchronous and/or asynchronous creation, or checks beforehand. If necessary, you can check which types of production are supported with code such as:</div>
      <PRE class="CF_-_Code_First_Line"><a name="1887292">var plugin : IDocumentProduction;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1887293">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1887313">plugin = PluginRegistry.getPluginRegistry().getPlugin(IDocumentProduction) as IDocumentProduction;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1887312">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1887296">if (plugin.synchronousCreationSupported(templateDescriptor)) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1887283">&nbsp;</a>&nbsp;...</PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="1887318">}</a></PRE>
      <div class="B_-_Body"><a name="2083658">For more information on these the </a><span class="cv_-_computer_voice">DocumentProduction</span> APIs, see the <span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('rules', 'cover-rules.html#1148079', '');" title="ClaimCenter Rules Guide">ClaimCenter Rules Guide</a></span>.</div>
      <div class="H2_-_Heading_2"><a name="2083659">Cached Document UIDs</a></div>
      <div class="B_-_Body"><a name="2083695">If a new document is created and an error occurs within the same database transaction, the error typically ensures </a>the database transaction rolls back. This means that no database data was changed. However, if the local ClaimCenter transaction rolls back, there is no stored reference in the ClaimCenter database to the document unique ID (UID). The UID describes the document’s location in the external system. This information is stored in the <span class="cv_-_computer_voice">Document</span> entity in ClaimCenter in the same transaction so in this case was not committed to the database. The new document in the external system is effectively <span class="e_-_emphasis">orphaned</span>, and additional attempts to change ClaimCenter data regenerates a new (duplicate) version of the document.</div>
      <div class="B_-_Body"><a name="2083538">For the common case of </a><span class="s_-_strong">validation errors</span>, ClaimCenter avoids this problem. If a validatable entity fails validation, ClaimCenter saves the document UID in local memory. If the user fixes the validation error in that user session, ClaimCenter adds the document information as expected so no externally-stored documents are orphaned.</div>
      <div class="B_-_Body"><a name="2120360">However, if other errors occur that cause the transaction to roll back (such as uncaught Gosu exceptions), exter</a>nally-stored documents associated with the current transaction could be orphaned. The document is stored externally but the ClaimCenter database contains no <span class="cv_-_computer_voice">Document</span> entity that references the document UID for it. Avoiding orphaned documents is a good reason to ensure your Gosu rules properly catches exceptions and handles errors elegantly and thoroughly. Write good error-handling code and logging code always, but particularly in document production code.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>