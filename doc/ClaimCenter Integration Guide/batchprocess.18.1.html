<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Custom Batch Processes</title>
    <link rel="StyleSheet" href="css/batchprocess.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body style="" onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>ClaimCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;">Custom Batch Processes</span></div>
    <hr align="left" />
    <div>
      <div class="CT_-_Chapter_Title"><a name="2185890">Custom Batch Processes</a></div>
      <div class="B_-_Body"><a name="2185909">You can add custom batch processes to perform background tasks. You can view batch processes (and work </a>queues) in the Internal Tools page in ClaimCenter.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2190906">For another type of customer-defined background process, see </a><a href="javascript:WWHClickedPopup('integration', 'plugins.09.12.html#2525000', '');" title="Startable Plugins">"Startable Plugins"</a>. </div>
      <div class="zChapterTopics">This topic includes:<a name="2190939">&nbsp;</a></div>
      <div class="zChapterTopic_outer" style="margin-left: 57.6pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="zChapterTopic_inner" style="width: 9.899999999999998pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="zChapterTopic_inner"><a href="javascript:WWHClickedPopup('integration', 'batchprocess.18.1.html#2186296', '');" title="Custom Batch Processes" name="2203827">Creating a Custom Batch Process</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="zChapterTopic_outer" style="margin-left: 57.6pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="zChapterTopic_inner" style="width: 9.899999999999998pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="zChapterTopic_inner"><a href="javascript:WWHClickedPopup('integration', 'batchprocess.18.2.html#2186025', '');" title="Custom Batch Processes and MaintenanceToolsAPI" name="2203832">Custom Batch Processes and MaintenanceToolsAPI</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="H1NB_-_Heading_1_No_Break"><a name="2186296">Creating a Custom Batch Process</a></div>
      <div class="B_-_Body"><a name="2199915">You can create batch processes to perform background tasks. ClaimCenter users can start, stop, or track progress </a>of the batch process in the user interface. </div>
      <div class="B_-_Body"><a name="2199944">Each batch process must provide a class that implements the </a><span class="cv_-_computer_voice">BatchProcess</span> interface. Although <span class="cv_-_computer_voice">BatchProcess</span> is an interface, it is <span class="s_-_strong">not</span> technically defined as a ClaimCenter <span class="e_-_emphasis">plugin</span>. You do not register it in the Studio Plugins editor. Also, other characteristics of plugins do not apply to this class, such plugin parameters and persistence rules. You need to ensure that ClaimCenter creates instances of your new class. To do this, there is a plugin interface called <span class="cv_-_computer_voice">IProcessesPlugin</span> that creates all the batch process objects. The <span class="cv_-_computer_voice">IProcessesPlugin</span> implementation simply instantiates all batch processes. </div>
      <div class="HS_-_Head_Sub"><a name="2186130">To create a custom batch process</a></div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><a name="2186350">In Studio, edit the </a><span class="cv_-_computer_voice">BatchProcessType</span> typecode. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LS2A_-_List_Start_002c_Level_2_Alpha_outer" style="margin-left: 67pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LS2A_-_List_Start_002c_Level_2_Alpha_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS2A_-_List_Start_002c_Level_2_Alpha_inner"><a name="2186381">Add an element to represent your own batch process. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI2A_-_List_Item_002c_Level_2_Alpha_outer" style="margin-left: 67pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner"><a name="2186462">In the typecode editor, for the new typecode, add one or more categories as they apply for your batch pro</a>cess. Use the <span class="cv_-_computer_voice">BatchProcessTypeUsage</span> typelist with following values:</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LP2_-_List_Para_002c_Level_2"><span class="cv_-_computer_voice"><a name="2186955">UIRunnable</a></span> - the process is runnable both from the user interface and from the web service APIs.</div>
      <div class="LP2_-_List_Para_002c_Level_2"><span class="cv_-_computer_voice"><a name="2186910">APIRunnable</a></span> - the process is only runnable from web service APIs.</div>
      <div class="LP2_-_List_Para_002c_Level_2"><span class="cv_-_computer_voice"><a name="2186911">Schedulable</a></span> - the process can be scheduled.</div>
      <div class="LP2_-_List_Para_002c_Level_2"><span class="cv_-_computer_voice"><a name="2186912">MaintenanceOnly</a></span> - only run the process if the system is at maintenance run level.</div>
      <div class="LP_-_List_Para"><a name="2188215">For more information about adding categories to typecodes, see </a><a href="javascript:WWHClickedPopup('config', 'studio_typelist.29.07.html#3600447', '');" title="Working with Typelists in Studio">“Working with Typelists in Studio” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('config', 'studio_typelist.29.07.html#3600447', '');" title="Working with Typelists in Studio">Configuration Guide</a></span>. Note that you must add at least one category or else your batch process cannot run. </div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="2191087">Creating this new typecode adds support for the new batch process within </a><span class="cv_-_computer_voice">BatchProcessInfo.pcf</span> and <span class="cv_-_computer_voice">IMaintenanceToolAPI</span>.</div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2191088">Create a class that extends the </a><span class="cv_-_computer_voice">BatchProcessBase</span> class (<span class="cv_-_computer_voice">gw.processes.BatchProcessBase</span><span style="font-family: &quot;Trebuchet MS&quot;; font-size: 9.1pt; font-weight: bold;">)</span>. This base class implements the <span class="cv_-_computer_voice">BatchProcess</span> interface. The only required method you must override is the <span class="cv_-_computer_voice">doWork</span> method, which takes no arguments. Do your batch processes work in this method. For more information about this class, including some optional methods to override, see <a href="javascript:WWHClickedPopup('integration', 'batchprocess.18.1.html#2185948', '');" title="Custom Batch Processes">"Batch Process Implementation Using BatchProcessBase"</a>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2190776">Modify the application code to create your new batch process. In the built-in implementation, there is no code </a>that instantiates your new batch process. When ClaimCenter needs to create a new batch process, it calls the registered plugin for the <span class="cv_-_computer_voice">IProcessesPlugin</span> interface. There is a built-in <span class="cv_-_computer_voice">IProcessesPlugin</span> implementation that adds all the built-in batch processes. To add your batch process type, either reimplement the existing <span class="cv_-_computer_voice">IProcessesPlugin</span> implementation and base yours on the code in the built-in implementation. The existing implementation looks like:</div>
            </td>
          </tr>
        </table>
      </div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190811">package gw.plugin.processes</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190812">uses gw.plugin.processing.IProcessesPlugin</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190813">uses gw.processes.BatchProcess</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190814">uses gw.util.ClaimHealthCalculatorBatch</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190815">uses gw.util.PurgeMessageHistory</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190816">use gw.util.CatastropheClaimFinderBatch</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190817">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190818">@Export</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190819">class ProcessesPlugin implements IProcessesPlugin {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190820">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190821">  construct() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190822">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190823">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190824">  override function createBatchProcess(type : BatchProcessType, arguments : Object[]) : BatchProcess {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190825">    switch(type) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190826">      case BatchProcessType.TC_CLAIMHEALTHCALC:</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190827">        return new ClaimHealthCalculatorBatch();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190828">      case BatchProcessType.TC_PURGEMESSAGEHISTORY:</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190829">        return new PurgeMessageHistory(arguments);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190830">      case BatchProcessType.TC_CATASTROPHECLAIMFINDER:</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190831">        return new CatastropheClaimFinderBatch(arguments);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190832">      default:</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190833">        return null</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190834">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190835">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190836">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190837">}</a></PRE>
      <div class="LP_-_List_Para"><a name="2190803">Add a new case statement to create your batch process, based on the typecode code that you created in the </a><span class="cv_-_computer_voice">BatchProcessType</span> typelist. For example, suppose you added the <span class="cv_-_computer_voice">ABC</span> typecode and your batch process class is <span class="cv_-_computer_voice">MyProcess</span>. Add the following lines to the <span class="cv_-_computer_voice">switch</span> statement (optionally passing the arguments array passed to <span class="cv_-_computer_voice">createBatchProcess</span>):</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2186708">case "ABC":</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2186709">        return new MyProcess(arguments);</a></PRE>
      <div class="LP_-_List_Para"><a name="2189085">If you already implemented this plugin because you already added a batch process, if you add more batch </a>processes just add more case statements as needed.</div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2189104">In Studio, in the Plugins editor, register your new plugin for the </a><span class="cv_-_computer_voice">IProcessesPlugin</span><span style="font-family: &quot;Lucida Sans Typewriter&quot;; font-size: 7.0pt;"> </span>plugin interface. If you already implemented this plugin because you already added a batch process, if you add more batch processes just add more case statements as needed and skip this step.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="ri_-_run_in_header">	5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2186766">If you want to schedule your new batch process, add the entry to the XML file </a><span class="cv_-_computer_voice">scheduler-config.xml</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="H2_-_Heading_2"><a name="2185948">Batch Process Implementation Using BatchProcessBase</a></div>
      <div class="B_-_Body"><a name="2187018">Each batch process must have an implementation of the </a><span class="cv_-_computer_voice">BatchProcess</span> interface, which defines the contract with ClaimCenter. The easist approach is to write a new Gosu class that extends the batch process base class: <span class="cv_-_computer_voice">gw.processes.BatchProcessBase</span>. This base class defines the basic implementation of the <span class="cv_-_computer_voice">BatchProcess</span> interface. </div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="2189167">Although </a><span class="cv_-_computer_voice">BatchProcess</span> is an interface, it is not technically defined as a ClaimCenter <span class="e_-_emphasis">plugin</span>. You do not register it in the Studio Plugins editor. Also, other characteristics of plugins do not apply to this class, such plugin parameters and persistence rules. However, you do need to specially create instances of your new class. There is a plugin interface called <span class="cv_-_computer_voice">IProcessesPlugin</span> that you must implement to use batch processes. The <span class="cv_-_computer_voice">IProcessesPlugin</span> implementation simply instantiates <span class="s_-_strong">all</span> batch processes. For more information, see <a href="javascript:WWHClickedPopup('integration', 'batchprocess.18.1.html#2186296', '');" title="Custom Batch Processes">"Creating a Custom Batch Process"</a>. </div>
      <div class="B_-_Body"><a name="2188646">Strictly speaking, the only required method for you to override is the </a><span class="cv_-_computer_voice">doWork</span> method, which takes no arguments. You can override other methods if you need to, but the base class defines meaningful defaults. </div>
      <div class="B_-_Body"><a name="2188680">It is critical to note that the </a><span class="cv_-_computer_voice">doWork</span> method does not have a bundle to track the database transaction. If you want to modify any data, you must use the <span class="cv_-_computer_voice">Transaction.runWithNewBundle(...)</span> API to create a bundle. </div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2188695">To modify entity data in your batch process, you must use the </a><span class="cv_-_computer_voice">runWithNewBundle</span> API. For more information about creating bundles, see <a href="javascript:WWHClickedPopup('gosu', 'transactions.21.4.html#1561481', '');" title="Running Code in an Entirely New Bundle">“Running Code in an Entirely New Bundle” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'transactions.21.4.html#1561481', '');" title="Running Code in an Entirely New Bundle">Gosu Reference Guide</a></span>.</div>
      <div class="B_-_Body"><a name="2189833">Ensure that your main </a><span class="cv_-_computer_voice">doWork</span> method frequently checks the <span class="cv_-_computer_voice">TerminateRequested</span> flag. If it is <span class="cv_-_computer_voice">true</span>, exit from your code. For example, if you are looping across a database query, exit from the loop. For more information, see <a href="javascript:WWHClickedPopup('integration', 'batchprocess.18.1.html#2187310', '');" title="Custom Batch Processes">"Request Termination"</a>.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2189905">ClaimCenter calls the </a><span class="cv_-_computer_voice">requestTermination</span> method in a different thread from the thread that runs your batch process <span class="cv_-_computer_voice">doWork</span> method.</div>
      <div class="B_-_Body"><a name="2187055">The following subtopics list other property getters or methods that you can call or override.</a></div>
      <div class="HS_-_Head_Sub"><a name="2187096">Check Initial Conditions</a></div>
      <div class="B_-_Body"><a name="2187148">ClaimCenter calls the batch process </a><span class="cv_-_computer_voice">checkInitialConditions</span> method to determine whether to create and start the batch process. If it returns true, ClaimCenter starts the batch process. If the initial conditions are not met, this method must return <span class="cv_-_computer_voice">false</span>. If you return false, ClaimCenter skips this batch process right now. The batch process schedule defines the next time that ClaimCenter calls this method. The batch process base class always returns <span class="cv_-_computer_voice">true</span>. Override this method if you need to customize this behavior. For example, you could check if system conditions are necessary for this batch process to run, such as the server run level.</div>
      <div class="HS_-_Head_Sub"><a name="2187310">Request Termination</a></div>
      <div class="B_-_Body"><a name="2187311">If a user clicks the </a><span class="ui_-_UI_element">Stop</span> button on the Batch Process Info page, this requets a batch process to terminate. ClaimCenter calls the batch process <span class="cv_-_computer_voice">requestTermination</span> method to terminate a batch process if possible. </div>
      <div class="B_-_Body"><a name="2199404">Your batch process must shut down any necessary systems and stop your batch process if you receive this </a>message. If you cannot terminate your batch process, return <span class="cv_-_computer_voice">false</span> from this method. The batch process base class always returns <span class="cv_-_computer_voice">false</span>, which means that the request did not succeed. The base class also sets an internal <span class="cv_-_computer_voice">TerminateRequested</span> flag that you can check to see if a terminate request was received.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2199376">ClaimCenter calls the </a><span class="cv_-_computer_voice">requestTermination</span> method in a different thread from the thread that runs your batch process <span class="cv_-_computer_voice">doWork</span> method.</div>
      <div class="B_-_Body"><a name="2199660">For typical implementations, use the following pattern:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2199378">Override the </a><span class="cv_-_computer_voice">requestTermination</span> method and have it return <span class="cv_-_computer_voice">true</span>. When the user requests termination of the batch process, the application calls your overriden version of the method. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2199286">Ensure that your main </a><span class="cv_-_computer_voice">doWork</span> method <span class="s_-_strong">frequently</span> checks the <span class="cv_-_computer_voice">TerminateRequested</span> flag. In your <span class="cv_-_computer_voice">doWork</span> code, exit from your code if that flag is set. For example, if you are looping across a database query, exit from the loop and return. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2189388">Override the </a><span class="cv_-_computer_voice">requestTermination</span> method and return <span class="cv_-_computer_voice">false</span> if you genuinely <span class="s_-_strong">cannot</span> terminate the process soon. Be warned that if you do this, you risk the server shutting down before your process completes. </div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="2189418">Although you can return </a><span class="cv_-_computer_voice">false</span> from <span class="cv_-_computer_voice">requestTermination</span>, Guidewire strongly recommends you design your batch process so that you actually can terminate the action. It is critical to understand that returning either value does <span class="s_-_strong">not</span> prevent the application from shutting down or reducing run level. ClaimCenter delays shutdown or change in run level for a period of time. However, eventually the application shuts down or reduces run level independent of this batch process setting. For maximum reliability and data integrity, design your code to frequently check and respect the <span class="cv_-_computer_voice">TerminateRequested</span> property.</div>
      <div class="B_-_Body"><a name="2189933">ClaimCenter writes a line to the system log to indicate whether the batch process says it could terminate. In other </a>words, the log line includes the result of your <span class="cv_-_computer_voice">requestTermination</span> method.</div>
      <div class="B_-_Body"><a name="2190182">If your batch process can only run one instance at a time, returning </a><span class="cv_-_computer_voice">true</span> does <span class="s_-_strong">not</span> remove the batch process from the internal table of running batch processes. This means that another instance cannot run until the previous one completes. For more information about exclusive-running batch processes, see <a href="javascript:WWHClickedPopup('integration', 'batchprocess.18.1.html#2189916', '');" title="Custom Batch Processes">"Exclusive"</a>.</div>
      <div class="HS_-_Head_Sub"><a name="2189916">Exclusive</a></div>
      <div class="B_-_Body"><a name="2189555">The property getter for the </a><span class="cv_-_computer_voice">Exclusive</span> poperty for a batch process determines whether another instance of this batch process can start while this process is running. The base class implementation always returns <span class="cv_-_computer_voice">true</span>. Override this method if you need to customize this behavior. This value does not affect whether other batch process classes can run. It only affects the current batch process class.</div>
      <div class="B_-_Body"><a name="2189594">For maximum performance, be sure to set this </a><span class="cv_-_computer_voice">false</span> if possible. For example, if your batch process takes arguments in its constructor, it might be specific to one entity such as only a single <span class="cv_-_computer_voice">Claim</span> entity. If you want to permit multiple instances of your batch process to run in parallel, you must ensure your batch process class implementation returns <span class="cv_-_computer_voice">false</span>. For example, </div>
      <PRE class="CF_-_Code_First_Line"><a name="2191044">override property get Exclusive() : boolean { </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2191046">&nbsp;</a>&nbsp;return false </PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="2191047">} </a></PRE>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="2190994">For Java implementations, you must implement this property getter as the method </a><span class="cv_-_computer_voice">isExclusive</span>, which takes no arguments.</div>
      <div class="HS_-_Head_Sub"><a name="2187449">Description</a></div>
      <div class="B_-_Body"><a name="2187450">The </a><span class="cv_-_computer_voice">getDescription</span> method gets the batch type’s description. The base class gets this string from the batch type typecode description. Override this method if you need to customize this behavior.</div>
      <div class="HS_-_Head_Sub"><a name="2187462">Detail Status</a></div>
      <div class="B_-_Body"><a name="2187463">The property getter for the </a><span class="cv_-_computer_voice">DetailStatus</span> property gets the batch type’s detailed status. The base class defines a default simple implementation. Override the default property getter to provide more useful detail information about the status of your batch process for the Administration user interface. The details might be important if your class experiences any error conditions.</div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="2191108">For Java implementations, you must implement this property getter as the method </a><span class="cv_-_computer_voice">getDetailStatus</span>, which takes no arguments.</div>
      <div class="HS_-_Head_Sub"><a name="2187816">Progress Handling</a></div>
      <div class="B_-_Body"><a name="2187826">The </a><span class="cv_-_computer_voice">Progress</span> property in the batch process dynamically returns the progress of the batch process. The base class returns text in the form <span class="cv_-_computer_voice">"x of y"</span> where <span class="cv_-_computer_voice">x</span> is the amount of work completed and <span class="cv_-_computer_voice">y</span> is the total amount of work. If <span class="cv_-_computer_voice">y</span> is unknown, returns just <span class="cv_-_computer_voice">"x"</span>. These values are determined from the <span class="cv_-_computer_voice">OperationsExpected</span> and <span class="cv_-_computer_voice">OperationsCompleted </span>properties. From Java, this is the <span class="cv_-_computer_voice">getProgress</span> method.</div>
      <div class="B_-_Body"><a name="2187852">The following list includes related properties and methods you can use that the base class implements:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2187562">OperationsExpected</a></span> property - a counter for how many operations are expected, as an <span class="cv_-_computer_voice">int</span> value. From Java this counter is the <span class="cv_-_computer_voice">getOperationsExpected</span> method.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2187578">OperationsCompleted</a></span> property - a counter for how many operations are complete, as an <span class="cv_-_computer_voice">int</span> value. From Java this counter is the <span class="cv_-_computer_voice">getOperationsCompleted</span> method.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2185979">incrementOperationsCompleted</a></span> method - this no-argument method increments an internal counter for how many operations completed. For example, suppose your batch process iterates across entities of some type with special conditions and specially handle each found item. For each entity you modify, call this method once to track the progress of this batch process. The user interface can display this number or debugging code can track this number to see the progress. This method returns the current number of operations completed. For each entity for which you have an error condition, call this method once to track the progress of this batch process.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2185980">OperationsFailed</a></span> property - an internal counter for the number of operations that failed. From Java this counter is the <span class="cv_-_computer_voice">getOperationsFailed</span> method.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2187774">incrementOperationsFailed()</a></span> method - this method increments an internal counter for how many operations failed. For example, suppose your batch process iterates across entities of some type with special conditions and specially handle each found item. For each entity for which you have an error condition, call this method once to track the progress of this batch process. The user interface can display this number or debugging code can track this number to see the progress. This method returns the current number of operations failed. You must also call the <span class="cv_-_computer_voice">incrementOperationsCompleted</span> method.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2199549">For any operations that fail, call both the </a><span class="cv_-_computer_voice">incrementOperationsFailed</span> method and the <span class="cv_-_computer_voice">incrementOperationsFailed.</span></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><span class="cv_-_computer_voice"><a name="2191352">Finished</a></span> property - return a Boolean value to indicate whether the process completed. Completion says nothing about the errors if any. From Java, this is the <span class="cv_-_computer_voice">isFinished</span> method.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="HS_-_Head_Sub"><a name="2187785">Type</a></div>
      <div class="B_-_Body"><a name="2187786">The base class maintains a </a><span class="cv_-_computer_voice">Type</span> property, which contains the batch process type, as a <span class="cv_-_computer_voice">BatchProcessType</span> typecode. From Java this counter is the <span class="cv_-_computer_voice">getType</span> method.</div>
      <div class="H3_-_Heading_3"><a name="2188847">Example Batch Process to Purge Workflows</a></div>
      <div class="B_-_Body"><a name="2188848">The following Gosu batch process purges old workflows. It takes one parameter that indicates the number of </a>days for successful processes. Pass this parameter in the constructor to this batch process class. In other words, your implementation of <span class="cv_-_computer_voice">IProcessesPlugin</span> must pass this parameter such as the <span class="cv_-_computer_voice">new</span><span class="cv_-_computer_voice">&nbsp;</span><span class="cv_-_computer_voice">MyClass(myParameter)</span> when it instantiates the batch process. If no parameter is missing or <span class="cv_-_computer_voice">null</span>, it uses a default system setting.</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188884">package gw.processes</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188885">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188886">uses gw.processes.BatchProcessBase</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188887">uses java.lang.Integer</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188888">uses gw.api.system.PLConfigParameters</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188889">uses gw.api.admin.WorkflowUtil</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188890">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188891">class PurgeWorkflows extends BatchProcessBase</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188892">{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188893">  var _succDays = PLConfigParameters.WorkflowPurgeDaysOld.Value</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188894">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188895">  construct() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188896">    this(null)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188897">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188898">  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188899">  construct(arguments : Object[]) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188900">    super("PurgeWorkflows")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188901">    if (arguments != null) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188902">      _succDays = arguments[0] != null ? (arguments[0] as Integer) : _succDays</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188903">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188904">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188905">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188906">  override function doWork() : void {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188907">    WorkflowUtil.deleteOldWorkflowsFromDatabase( _succDays )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188908">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188909">}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188864">&nbsp;</a></PRE>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2188939">Remember that if you want to modify entity data in your batch process, you must use </a>the <span class="cv_-_computer_voice">runWithNewBundle</span> API. For more information about creating bundles, see <a href="javascript:WWHClickedPopup('gosu', 'transactions.21.4.html#1561481', '');" title="Running Code in an Entirely New Bundle">“Running Code in an Entirely New Bundle” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'transactions.21.4.html#1561481', '');" title="Running Code in an Entirely New Bundle">Gosu Reference Guide</a></span>.</div>
      <div class="H3_-_Heading_3"><a name="2188854">Example Batch Process to Enforce Urgent Activities</a></div>
      <div class="B_-_Body"><a name="2188849">The following is a sample customer batch process. It implements a notification scheme such that any urgent </a>request must be handled within 30 minutes. If it is not handled within that time range, the batch process notifies a supervisor. If still not resolved in 60 minutes, it sends a message further up the supervisor chain.</div>
      <div class="B_-_Body"><a name="2188429">If there are no qualified activities, it returns false so that it will not create a process history. If there are items to </a>handle, it increments the count. The application uses this count to display batch process status <span class="cv_-_computer_voice">"n of t"</span> or a progress bar. If there are no contact email addresses, the task fails and the application flags it as a failure.</div>
      <div class="B_-_Body"><a name="2188432">This example checks </a><span class="cv_-_computer_voice">TerminateRequested</span> to terminate the loop if the user or the application requested to terminate the process.</div>
      <div class="B_-_Body"><a name="2188626">In this Gosu example, it does not actually send the email. Instead it prints to the console. You can change this to </a>use the real email APIs if desired.</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188443">package sample.processes</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188444">uses gw.processes.BatchProcessBase</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188445">uses java.util.Map</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188446">uses gw.api.util.DateUtil</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188447">uses java.lang.StringBuilder</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188448">uses java.util.HashMap</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188449">uses gw.api.profiler.Profiler</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188450">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188451">class TestBatch extends BatchProcessBase</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188452">{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188453">  static var tag = new gw.api.profiler.ProfilerTag("TestBatchTag1","A sample tag")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188454">  var work : ActivityQuery</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188455">  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188456">  construct() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188457">    super( "TestBatch")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188458">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2199585">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2199596">&nbsp;</a>&nbsp;override function requestTermination() :Boolean {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2199605">&nbsp;</a>&nbsp;&nbsp;&nbsp;super.requestTermination() // set the TerminationRequested flag</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2199619">&nbsp;</a>&nbsp;&nbsp;&nbsp;return true // return true to signal that we will attempt to terminate in our doWork method</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2199647">&nbsp;</a>&nbsp;&nbsp;}</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2199612">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188459">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188460">  override function doWork() : void { // no bundle</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188461">    var frame = Profiler.push(tag);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188462">    try {    </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188463">      work = find(a in Activity where a.Priority == "urgent" and a.Status == "open" </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190501">&nbsp;</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and a.CreateTime &lt; DateUtil.currentDate().addMinutes( -30 ) )</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188464">      OperationsExpected = work.getCount()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190423">&nbsp;</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var map = new HashMap&lt;Contact, StringBuilder&gt;()</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188466">for (activity in work) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188467">        if (TerminateRequested) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188468">          return;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188469">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188470">        incrementOperationsCompleted()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188471">        var haveContact = false</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188472">        var msgFragment = constructFragment(activity)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188473">        haveContact = addFragmentToUser(map, activity.AssignedUser, msgFragment) or haveContact</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188474">        var group = activity.AssignedGroup</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188475">        haveContact = addFragmentToUser(map, group.Supervisor, msgFragment) or haveContact</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188476">        if (activity.CreateTime &lt; DateUtil.currentDate().addMinutes( -60 )) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188477">          while (group != null) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188478">            group = group.Parent</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188479">            haveContact = addFragmentToUser(map, group.Supervisor, msgFragment) or haveContact</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188480">          }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188481">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188482">        if (!haveContact) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188483">          incrementOperationsFailed()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188484">          addFragmentToUser(map, User.util.UnrestrictedUser, msgFragment)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188485">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188486">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188487">      if (not TerminateRequested) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188488">        for (addressee in map.Keys) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188489">          sendMail(addressee, "Urgent activities still open", map.get(addressee).toString())</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188490">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188491">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188492">    } </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188493">    finally {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188494">       Profiler.pop(frame)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188495">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188496">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188497">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188498">  private function constructFragment(activity : Activity) : String {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188499">    return formatAsURL(activity) + "\n\t"</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188500">      + " Subject: " + activity.Subject </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188501">      + " AssignedTo: " + activity.AssignedUser</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188502">      + " Group: " + activity.AssignedGroup</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188503">      + " Supervisor: " + activity.AssignedGroup.Supervisor</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188504">      + "\n\t" + activity.Description</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188505">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188506">  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188507">  private function formatAsURL(activity : Activity) : String {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188508">    return "http://localhost:8080/cc/Activity.go(${activity.id})</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2189655">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2189666">&nbsp;</a>&nbsp;&nbsp;&nbsp;// TODO: you must ADD A PCF ENTRYPOINT THAT CORRESPONDS TO THIS URL TO DISPLAY THE ACTIVITY.</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188509">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188510">    </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188511">  private function addFragmentToUser(map : Map&lt;String, StringBuilder&gt;, user : User, </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190512">&nbsp;</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgFragment : String) : boolean { </PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188512">    if (user != null) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188513">      var email = user.Contact.EmailAddress1</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188514">      if (email != null and email.trim().length &gt; 0) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188515">        var sb = map.get(email)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188516">        if (sb == null) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188517">          sb = new StringBuilder()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188518">          map.put(email, sb)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188519">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188520">        sb.append(msgFragment)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188521">        return true</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188522">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188523">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188524">    return false;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188525">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188526">  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190459">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190460">  private function sendMail(contact : Contact, subject : String, body : String) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190461">    var email = new Email()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190462">    email.Subject = subject</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190463">    email.Body = "&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"&gt;\n" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190464">                 "&lt;html&gt;\n" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190465">                 "  &lt;head&gt;\n" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190466">                 "  &lt;meta http-equiv=\"content-type\"\n" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190467">                 "    content=\"text/html; charset=UTF-8\"&gt;\n" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190468">                 "    &lt;title&gt;${subject}&lt;/title&gt;\n" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190469">                 "  &lt;/head&gt;\n" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190470">                 "  &lt;body&gt;\n" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190471">                 "    &lt;table&gt;\n" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190472">                 "     &lt;tr&gt;&lt;th&gt;Subject&lt;/th&gt;&lt;th&gt;User&lt;/th&gt;&lt;th&gt;Group&lt;/td&gt;&lt;th&gt;Supervisor&lt;/th&gt;&lt;/tr&gt;" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190473">                 body +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190474">                 "    &lt;/table&gt;" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190475">                 "  &lt;/body&gt;" +</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190476">                 "&lt;/html&gt;" </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190477">    email.addToRecipient(new EmailContact(contact))</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190478">    EmailUtil.sendEmailWithBody(null, email);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188531">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190451">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188532">}</a></PRE>
      <div class="B_-_Body"><a name="2190261">To use this entry point, use the following PCF entry point in the file </a><span class="cv_-_computer_voice">ClaimCenter/modules/configuration/</span><span class="cv_-_computer_voice">pcf/EntryPoints/Activity.pcf</span>:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190276">&lt;PCF&gt;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190277">&lt;EntryPoint authenticationRequired="true" id="Activity" location="ActivityForward(actvtIdNum)"&gt;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190278">&lt;EntryPointParameter locationParam="actvtIdNum" type="int"/&gt;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190279">&nbsp; &lt;/EntryPoint&gt;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190280">&lt;/PCF&gt;</a></PRE>
      <div class="B_-_Body"><a name="2190353">Also include the following </a><span class="cv_-_computer_voice">ActivityForward</span> PCF file as the <span class="cv_-_computer_voice">ActivityForward.pcf</span> in each place in the PCF hierarchy that you would like it:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190354">&lt;PCF&gt;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190355">&nbsp; &lt;Forward id="ActivityForward"&gt;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190285">&nbsp;&nbsp;&nbsp; &lt;LocationEntryPoint signature="ActivityForward(actvtIdNum : int)"/&gt;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190286">&nbsp;&nbsp;&nbsp; &lt;Variable name="actvtIdNum" type="int"/&gt;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190287">&lt;Variable</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190288">&nbsp; initialValue="find(a in Activity where a.ID == new Key(Activity, actvtIdNum))"</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190289">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name="actvt"</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190379">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type="Activity"/&gt;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190386">&nbsp;&nbsp;&nbsp; &lt;ForwardCondition action="ClaimForward.go(actvt.Claim);</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190399">&nbsp;</a>&nbsp;&nbsp;ActivityDetailWorksheet.goInWorkspace(actvt)"/&gt;</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190293">&nbsp; &lt;/Forward&gt;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190294">&lt;/PCF&gt;</a></PRE>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2190263">Remember that if you want to modify entity data in your batch process, you must use </a>the <span class="cv_-_computer_voice">runWithNewBundle</span> API. For more information about creating bundles, see <a href="javascript:WWHClickedPopup('gosu', 'transactions.21.4.html#1561481', '');" title="Running Code in an Entirely New Bundle">“Running Code in an Entirely New Bundle” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'transactions.21.4.html#1561481', '');" title="Running Code in an Entirely New Bundle">Gosu Reference Guide</a></span>.</div>
      <div class="H2_-_Heading_2"><a name="2188414">Batch Process History</a></div>
      <div class="B_-_Body"><a name="2187957">A built-in startable plugin creates a process history entry for every run of each batch process. Refer to the </a><span class="cv_-_computer_voice">ProcessHistory</span> entity in the Data Dictionary for details of its properties.</div>
      <div class="B_-_Body"><a name="2191240">To get the current batch process history entity from a batch process instance, get its </a><span class="cv_-_computer_voice">ProcessHistory</span> property. From Java, this is the <span class="cv_-_computer_voice">getProcessHistory</span> method.</div>
      <div class="B_-_Body"><a name="2187993">If there is no work or if the batch process constructor throws an exception, the application capture and logs those </a>errors also.</div>
      <div class="B_-_Body"><a name="2189738">In ClaimCenter, there is a batch process that purges process history entities when they are old. </a></div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </div>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>