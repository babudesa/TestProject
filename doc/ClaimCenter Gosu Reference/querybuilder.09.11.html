<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Converting to Collections, Lists, Sets, and Arrays</title>
    <link rel="StyleSheet" href="css/querybuilder.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>Gosu Reference Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="querybuilder.09.01.html#2232426">Query Builder</a> : <a class="WebWorks_Breadcrumb_Link" href="querybuilder.09.08.html#2232426">Returning Query Results</a> : Converting to Collections, Lists, Sets, and Arrays</span></div>
    <hr align="left" />
    <blockquote>
      <div class="H2B_-_Heading_2_Break"><a name="2232426">Converting to Collections, Lists, Sets, and Arrays</a></div>
      <div class="B_-_Body"><a name="2232434">You can convert query result sets to lists, collections, and sets. Converting a query to these types runs the data</a>base query and iterates across the entire set. The application pulls all entities into local memory. Because of limitations of memory, database performance, and CPU performance, never do this for queries of unknown size. Only do this if you are absolutely certain that the result set size and the size of the object graphs are within acceptable limits. Be sure to test your assumptions under real-world conditions. </div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="2232451">Converting a query to lists or arrays pulls all the entities into local memory. Only do this </a>if you are absolutely certain the result set size and the size of the objects are small. Otherwise you risk memory and performance problems.</div>
      <div class="B_-_Body"><a name="2232688">If you need the results as an array, you can convert to a list and then convert that to an array using Gosu enhance</a>ment methods.</div>
      <div class="B_-_Body"><a name="2232427">The following example converts queries to different collection-related types including arrays:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233371">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233372">var q = Query.make(User)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233373">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233374">// in production code, converting to lists or arrays can be dangerous</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233375">// due to memory and performance issues. Never use this approach unless you are certain</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233376">// the result size is small. In this demonstration, we check the count first.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233377">// In real world code, you would not use this approach with the User table, which</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233378">// can be larger than 100 rows.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233379">if (q.select().Count &lt; 100) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233380">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233381">  var rc = q.select().toCollection()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233382">  var rs = q.select().toSet()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233383">  var rl = q.select().toList()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233384">  var ra = q.select().toTypedArray()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233385">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233386">  print("Collection: statictypeof " + statictypeof rc + "/ typeof " + typeof rc + "/ size " + rc.Count)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233387">  print("Set: statictypeof " + statictypeof rs + "/ typeof " + typeof rs + "/ size " + rs.Count)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233388">  print("List: statictypeof " + statictypeof rl + "/ typeof " + typeof rl + "/ size " + rl.Count)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233389">  print("Array: statictypeof " + statictypeof ra + "/ typeof " + typeof ra + "/ size " + ra.Count)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233390"> }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233391"> else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233392">  Throw("too many query results to convert to in-memory collections")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233196"> }</a></PRE>
      <div class="B_-_Body"><a name="2233187">This example prints something like the following:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233347">Collection: statictypeof java.util.Collection&lt;entity.User&gt;/ typeof java.util.ArrayList/ size 34</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233348">Set: statictypeof java.util.Set&lt;entity.User&gt;/ typeof java.util.HashSet/ size 34</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233349">List: statictypeof java.util.List&lt;entity.User&gt;/ typeof java.util.ArrayList/ size 34</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233419">Array: statictypeof entity.User[]/ typeof entity.User[]/ size 34</a></PRE>
      <div class="B_-_Body"><a name="2233488">Notice the types of the Java-based classes (collection, set, and lists) that the example prints. The compile time </a>types (this is what <span class="cv_-_computer_voice">statictypeof</span> returns) are parameterized with the query entity type (in this case, <span class="cv_-_computer_voice">User</span>). However, the run time type (what <span class="cv_-_computer_voice">typeof</span> returns) does not have the parameterization. This is due to generics differences between Gosu and Java. Java implements generics with <span class="e_-_emphasis">erasure</span>, which means that at run time the parameterization with the exact type is lost. The parameterization does not exist at run time. This behavior is not true for Gosu. If those classes were Gosu classes, the run-time type would preserve the parameterization.</div>
      <div class="B_-_Body"><a name="2234605">In contrast, note that the </a><span class="cv_-_computer_voice">toTypedArray</span> method generates an array properly typed (an array of <span class="cv_-_computer_voice">User</span>) both at compile time and at run time. </div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>