<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Returning Query Results</title>
    <link rel="StyleSheet" href="css/querybuilder.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body style="" onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>Gosu Reference Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="querybuilder.09.1.html#2231888">Query Builder</a> : Returning Query Results</span></div>
    <hr align="left" />
    <div>
      <div class="H1_-_Heading_1"><a name="2231888">Returning Query Results</a></div>
      <div class="B_-_Body"><a name="2231889">To extract rows from a query, call the </a><span class="cv_-_computer_voice">select</span> method on the query (or table, or the result of a chained series of clauses). The <span class="cv_-_computer_voice">select</span> method returns a query result object. This is the type <span class="cv_-_computer_voice">IQueryResult&lt;QT,RT&gt;</span> in the <span class="cv_-_computer_voice">gw.api.database</span> package. The <span class="cv_-_computer_voice">&lt;QT,RT&gt;</span> part of that type name is generics notation (see <a href="javascript:WWHClickedPopup('gosu', 'generics.18.1.html#1455314', '');" title="Gosu Generics">"Gosu Generics"</a>) that indicates it is parameterized across two dimensions:</div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><span class="cvt_-_computer_voice_table"><a name="2197555">QT</a></span> - the query type. This means the entity type you are searching for, such as <span class="cvt_-_computer_voice_table">Contact</span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><span class="cvt_-_computer_voice_table"><a name="2202459">RT</a></span> - the return type for that column</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2202460">This means that the </a><span class="cv_-_computer_voice">IQueryResult</span> works with many different combinations of query types and return types in a flexible way and yet is statically typed at compile time.</div>
      <div class="B_-_Body"><a name="2202461">Use the query result in the following ways:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2188676">iterate across results</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2188677">order results based on existing database columns (see </a><a href="javascript:WWHClickedPopup('gosu', 'querybuilder.09.7.html#2188751', '');" title="Returning Query Results">"Ordering results"</a>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2188678">filter the original query</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2197636">load only a subset of columns (see </a><a href="javascript:WWHClickedPopup('gosu', 'querybuilder.09.7.html#2233459', '');" title="Returning Query Results">"Selecting Columns and Returning Results in Custom Formats"</a>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2197663">encapsulate or return each row in any arbitrary format (see </a><a href="javascript:WWHClickedPopup('gosu', 'querybuilder.09.7.html#2233459', '');" title="Returning Query Results">"Selecting Columns and Returning Results in Custom Formats"</a>)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2188679">get the number of rows in the result set as of now. Remember that because databases are dynamic, the number </a>of results might change between now and additional actions on the query. Carefully design your code to support this number changing possibility.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="HS_-_Head_Sub"><a name="2232084">Getting Single Rows</a></div>
      <div class="B_-_Body"><a name="2232085">The query result object defines several methods for getting a single item.</a></div>
      <div class="B_-_Body"><a name="2232111">To get the first item only, simply call the enhancement property </a><span class="cv_-_computer_voice">FirstResult</span>:</div>
      <div class="CS_-_Code_Single_Line" style="font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline;"><span class="cvt_-_computer_voice_table"><a name="2232086">var u1 = q1.select().FirstResult</a></span></div>
      <div class="B_-_Body"><a name="2232087">If you want to get the first item and ensure there is only one match, call the enhancement property </a><span class="cv_-_computer_voice">AtMostOneRow</span> on this <span class="cv_-_computer_voice">Iterable</span> object. If there is more than one match, Gosu throws an exception. However, if there are no matches, this returns <span class="cv_-_computer_voice">null</span>. The following example gets one row in this way:</div>
      <div class="CS_-_Code_Single_Line"><span class="cvt_-_computer_voice_table"><a name="2232088">var u2 = </a></span>q2.select().AtMostOneRow</div>
      <div class="B_-_Body"><a name="2232089">To ensure there is exactly one match, instead use the </a><span class="cv_-_computer_voice">single</span> method (not a property). It throws an exception if there no matches, in contrast to the <span class="cv_-_computer_voice">AtMostOneRow</span> property:</div>
      <div class="CS_-_Code_Single_Line"><span class="cvt_-_computer_voice_table"><a name="2232090">var u3 = </a></span>q3.select().single()</div>
      <div class="HS_-_Head_Sub"><a name="2231789">Getting Results With an Iterator</a></div>
      <div class="B_-_Body"><a name="2232071">The </a><span class="cv_-_computer_voice">IQueryResult&lt;QT,RT&gt;</span> class implements the <span class="cv_-_computer_voice">Iterable</span> interface. This means it provides an iterator (the class <span class="cv_-_computer_voice">Iterator</span>). The easiest way to use an iterable object is with a <span class="cv_-_computer_voice">for</span> loop. For example:</div>
      <PRE class="CF_-_Code_First_Line"><a name="2224406">uses gw.api.database.Query</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224407">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224408">var q = Query.make(Contact)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224409">var count = 0</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224410">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224411">for (e in q.select()) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224412">  count++</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224413">  print("Result #" + count + " is " + e)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224414">}</a></PRE>
      <div class="B_-_Body"><a name="2232618">You can also get the iterator directly from the query result by calling the </a><span class="cv_-_computer_voice">iterator</span> method. For example:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2232620">uses gw.api.database.Query</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2232621">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224455">var q = Query.make(Contact)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224456">var i = q.select().iterator()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224457">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224458">if (i.hasNext()) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224459">  var n = i.next().DisplayName;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224460">  print("Display Name is " + n)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224461">}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224462">else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224463">  Throw("We expected at least one Contact")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2224464">}</a></PRE>
      <div class="HS_-_Head_Sub"><a name="2232426">Converting to Collections, Lists, Sets, and Arrays</a></div>
      <div class="B_-_Body"><a name="2232434">You can convert query result sets to lists, collections, and sets. Converting a query to these types runs the data</a>base query and iterates across the entire set. The application pulls all entities into local memory. Because of limitations of memory, database performance, and CPU performance, never do this for queries of unknown size. Only do this if you are absolutely certain that the result set size and the size of the object graphs are within acceptable limits. Be sure to test your assumptions under real-world conditions. </div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="2232451">Converting a query to lists or arrays pulls all the entities into local memory. Only do this </a>if you are absolutely certain the result set size and the size of the objects are small. Otherwise you risk memory and performance problems.</div>
      <div class="B_-_Body"><a name="2232688">If you need the results as an array, you can convert to a list and then convert that to an array using Gosu enhance</a>ment methods.</div>
      <div class="B_-_Body"><a name="2232427">The following example converts queries to different collection-related types including arrays:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233371">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233372">var q = Query.make(User)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233373">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233374">// in production code, converting to lists or arrays can be dangerous</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233375">// due to memory and performance issues. Never use this approach unless you are certain</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233376">// the result size is small. In this demonstration, we check the count first.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233377">// In real world code, you would not use this approach with the User table, which</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233378">// can be larger than 100 rows.</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233379">if (q.select().Count &lt; 100) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233380">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233381">  var rc = q.select().toCollection()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233382">  var rs = q.select().toSet()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233383">  var rl = q.select().toList()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233384">  var ra = q.select().toTypedArray()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233385">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233386">  print("Collection: statictypeof " + statictypeof rc + "/ typeof " + typeof rc + "/ size " + rc.Count)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233387">  print("Set: statictypeof " + statictypeof rs + "/ typeof " + typeof rs + "/ size " + rs.Count)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233388">  print("List: statictypeof " + statictypeof rl + "/ typeof " + typeof rl + "/ size " + rl.Count)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233389">  print("Array: statictypeof " + statictypeof ra + "/ typeof " + typeof ra + "/ size " + ra.Count)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233390"> }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233391"> else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233392">  Throw("too many query results to convert to in-memory collections")</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233196"> }</a></PRE>
      <div class="B_-_Body"><a name="2233187">This example prints something like the following:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233347">Collection: statictypeof java.util.Collection&lt;entity.User&gt;/ typeof java.util.ArrayList/ size 34</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233348">Set: statictypeof java.util.Set&lt;entity.User&gt;/ typeof java.util.HashSet/ size 34</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233349">List: statictypeof java.util.List&lt;entity.User&gt;/ typeof java.util.ArrayList/ size 34</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233419">Array: statictypeof entity.User[]/ typeof entity.User[]/ size 34</a></PRE>
      <div class="B_-_Body"><a name="2233488">Notice the types of the Java-based classes (collection, set, and lists) that the example prints. The compile time </a>types (this is what <span class="cv_-_computer_voice">statictypeof</span> returns) are parameterized with the query entity type (in this case, <span class="cv_-_computer_voice">User</span>). However, the run time type (what <span class="cv_-_computer_voice">typeof</span> returns) does not have the parameterization. This is due to generics differences between Gosu and Java. Java implements generics with <span class="e_-_emphasis">erasure</span>, which means that at run time the parameterization with the exact type is lost. The parameterization does not exist at run time. This behavior is not true for Gosu. If those classes were Gosu classes, the run-time type would preserve the parameterization.</div>
      <div class="B_-_Body"><a name="2234605">In contrast, note that the </a><span class="cv_-_computer_voice">toTypedArray</span> method generates an array properly typed (an array of <span class="cv_-_computer_voice">User</span>) both at compile time and at run time. </div>
      <div class="H3_-_Heading_3"><a name="2233459">Selecting Columns and Returning Results in Custom Formats</a></div>
      <div class="B_-_Body"><a name="2188701">In many situations you only need a few columns from the result instead of the whole entity. You can use a variant </a>of the <span class="cvt_-_computer_voice_table">select</span> method to do this. The <span class="cvt_-_computer_voice_table">select</span> method is only available off of queries.</div>
      <div class="B_-_Body"><a name="2190834">Instead of calling the </a><span class="cv_-_computer_voice">select</span> method with no arguments, use an alternate method signature that takes a <span class="e_-_emphasis">block</span>. A block is an in-line function that you define within another function. For more information about blocks, see <a href="javascript:WWHClickedPopup('gosu', 'blocks.17.1.html#1445150', '');" title="Gosu Blocks">"Gosu Blocks"</a>. You pass a block that takes an object of the query type and returns whatever you want. The return type can be anything that you specify. Any arbitrary type is fine, so you can choose whatever is most convenient for your program. The type does not need to match the native types for the columns in the database. </div>
      <div class="B_-_Body"><a name="2190864">The full method signature of this alternate </a><span class="cvt_-_computer_voice_table">select</span> method is the following:</div>
      <div class="CS_-_Code_Single_Line"><a name="2188703">function select&lt;RT&gt;(columns : block(row : QT) : RT) : IQueryResult&lt;QT, RT&gt;</a></div>
      <div class="B_-_Body"><a name="2213875">Note that the function returns an </a><span class="cv_-_computer_voice">IQueryResult</span> parameterized by the original query type, as well as the return type of your block. This allows Gosu to infer the block return type from the type of the query due to how Gosu generics work. You do not need to specify the return type of your block explicitly. For related topics, see <a href="javascript:WWHClickedPopup('gosu', 'generics.18.5.html#1447291', '');" title="Generics and Blocks">"Generics and Blocks"</a> and <a href="javascript:WWHClickedPopup('gosu', 'generics.18.6.html#1441541', '');" title="How Generics Help Define Collection APIs">"How Generics Help Define Collection APIs"</a>.</div>
      <div class="B_-_Body"><a name="2190908">This alternative select method provides the following important benefits:</a></div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><span class="ri_-_run_in_header"><a name="2190923">Gosu only loads the columns you need.</a></span> The database returns <span class="s_-_strong">only</span> the columns you access in your block. This reduces memory usage and improves overall server performance.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><span class="ri_-_run_in_header"><a name="2190946">You can assemble arbitrary structures or calculations to return in place of full entities.</a></span> Since you are not retrieving the entire entity, you choose how to return each result. For example, you can populate a custom Gosu class containing only the fields you need. Or you can simply return a single field that you need, such as a public ID string.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2190998">Gosu determines which columns to load by inspecting the block at compile time (at a low level) to determine </a>which database columns are affected by the query. At compile time, Gosu looks inside the block <span class="s_-_strong">without </span><span class="s_-_strong">running</span> it. By detecting that you referenced the <span class="cvt_-_computer_voice_table">Address1</span> property on an <span class="cvt_-_computer_voice_table">Address</span> entity, Gosu knows that it must load the <span class="cvt_-_computer_voice_table">Address1</span> property. Any properties not mentioned at all in your block are not loaded from the database for this query.</div>
      <div class="B_-_Body"><a name="2191092">As you iterate across the result set, after a row loads from the database, Gosu runs your block.</a></div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2191016">Gosu actually inspects the parse tree of the </a><span class="cv_-_computer_voice">select</span> block to determine which properties to load at run time. For each result in the result set, Gosu executes your block and replaces the values of database columns with values from the database. </div>
      <div class="B_-_Body"><a name="2190999">Gosu imposes the following rules on what kinds of tasks you can do inside the Gosu block:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2191000">All references from the block argument (the database row) must be references to properties backed by actual </a>database columns. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="2191192">You cannot use virtual properties, enhancement methods, or other entity methods within </a>the block that you pass to select. If you are unsure which properties are backed by actual database columns, refer to the <span class="e_-_emphasis">Data Dictionary</span>.</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2191001">Any references to a database function, which are static methods on the </a><span class="cv_-_computer_voice">DBFunction</span> class, must contain exactly one column reference. Additionally that column reference can have a cast associated with it, and that cast becomes a database cast in the final output). </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2190194">For example, to extract two database columns into a hash map mapping a </a><span class="cv_-_computer_voice">String</span> to <span class="cv_-_computer_voice">Integer</span>, you could use code similar to the following:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190196">var rows = Query.make(MyEntity).select(\row-&gt; new HashMap&lt;String, Integer&gt;() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188712">&nbsp;</a>&nbsp;"A" -&gt; row.A,</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188713">&nbsp;</a>&nbsp;"E" -&gt; row.E</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190190">})</a></PRE>
      <div class="B_-_Body"><a name="2190191">This returns an </a><span class="cv_-_computer_voice">IQueryResult&lt;</span><span style="font-family: &quot;Lucida Sans Typewriter&quot;; font-size: 7.0pt;">MyEntity</span><span class="cv_-_computer_voice">, HashMap&lt;String,Integer&gt;&gt;</span>. The <span class="cv_-_computer_voice">IQueryResult</span> class extends <span class="cv_-_computer_voice">Iterable</span>, more specifically <span class="cv_-_computer_voice">IQueryResult&lt;QT,RT&gt;</span> extends <span class="cv_-_computer_voice">Iterable&lt;RT&gt;</span>. This means that this method returns an iterable object of type <span class="cv_-_computer_voice">Iterable&lt;HashMap&lt;String,Integer&gt;&gt;</span>.</div>
      <div class="B_-_Body"><a name="2188716">In the previous example, note the references to </a><span class="cv_-_computer_voice">row.A</span> and <span class="cv_-_computer_voice">row.E</span>. In the final result, these references become database references.</div>
      <div class="B_-_Body"><a name="2190185">The following is a more subtle example that fetches three columns, assuming that MyEntity.E references an </a>entity that contains properties named E1 and E2:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190187">var rows = Query.make(MyEntity).select(\row-&gt; new HashMap&lt;String, Integer&gt;() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188720">&nbsp;</a>&nbsp;"A_plus_ten" -&gt; row.A + 10,</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188721">&nbsp;</a>&nbsp;"E1_minus_E2" -&gt; row.E.E1 - row.E.E2</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188722">})</a></PRE>
      <div class="B_-_Body"><a name="2188723">The columns in the following example are more subtle. This fetches three columns from the database:</a></div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt;margin-bottom: 2.0pt; margin-top: 2.0pt; vertical-align: baseline;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none;"><span class="cvt_-_computer_voice_table"><a name="2190585">row.A</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt;margin-bottom: 2.0pt; margin-top: 2.0pt; vertical-align: baseline;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none;"><span class="cvt_-_computer_voice_table"><a name="2190600">row.E.E1</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt;margin-bottom: 2.0pt; margin-top: 2.0pt; vertical-align: baseline;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none;"><span class="cvt_-_computer_voice_table"><a name="2190608">row.E.E2</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="2190180">Note that Gosu permits the line with a computation computes </a><span class="cv_-_computer_voice">row.A + 10</span>. Gosu does not optimize this using the SQL feature called <span class="e_-_emphasis">computed</span><span class="e_-_emphasis">&nbsp;</span><span class="e_-_emphasis">columns</span>. Gosu query builder does not support computed columns. Instead, Gosu simply loads the columns from the database and performs the calculation in the Gosu block at run time. Be aware of this implementation detail if you implement complex calculations in your block. If you have complex calculations in your block, remember to test and profile performance at run time with large loads to determine the performance impact of your calculations.</div>
      <div class="B_-_Body"><a name="2191237">The following is a complex example that returns a custom anonymous inner class and initializing two properties </a>(A and E): </div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190182">&nbsp;</a>&nbsp;var rows = Query.make(TestA).select(\row-&gt; {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188728">      if (row.A &lt; 10) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188729">        return new MyObject() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188730">          :A row.A + 10,</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188731">          :E -&gt; row.E.E1 - row.E.E2</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188732">        })</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188733">      } else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188734">        return new MyObject() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188735">          :A row.A + 1000,</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188736">          :E -&gt; row.E.E1 + row.E.E2</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188737">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188738">    }</a></PRE>
      <div class="HS_-_Head_Sub"><a name="2190175">Database Functions Within Select Blocks</a></div>
      <div class="B_-_Body"><a name="2191311">The following is an example that uses a database function:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190177">var rows = Query.make(TestA).select(\row-&gt; new HashMap&lt;String, Integer&gt;() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188746">      "A" -&gt; DBFunction.SUM(row.A as double),</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188747">      "A2" -&gt; row.A2</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190170">    })</a></PRE>
      <div class="B_-_Body"><a name="2190171">It returns the summary of all </a><span class="cv_-_computer_voice">TestA.A</span>, coerced to <span class="cv_-_computer_voice">double</span> to show how to do coercion, and then finally grouped by the property <span class="cv_-_computer_voice">TestA.A2</span>.</div>
      <div class="B_-_Body"><a name="2190172">Within your block, you can use the following database functions: </a><span class="cv_-_computer_voice">Sum</span>, <span class="cv_-_computer_voice">Max</span>, <span class="cv_-_computer_voice">Min</span>, <span class="cv_-_computer_voice">Avg</span>, and <span class="cv_-_computer_voice">Count</span>.</div>
      <div class="H3_-_Heading_3"><a name="2188751">Ordering results</a></div>
      <div class="B_-_Body"><a name="2188752">Gosu provides methods on the result set objects that order the results in the result set. Gosu uses this information </a>to generate different SQL so the results return in the appropriate order. The database does the ordering and returns records in the correct order. Gosu does not need to load the result into memory to order them. Loading all the entities into memory would often require too much memory and the performance would be poor. Instead, Gosu modifies the SQL that returns the results in the desired order.</div>
      <div class="B_-_Body"><a name="2188753">Gosu supports multiple levels of sorting on different columns. For example, you could sort an address book table </a>by last name. If last names match for two rows, then sort them by first name. If both first and last name match, sort by birth date. Gosu represents this by a series of methods you call. First, call the method to order by the first desired column, either in ascending order (<span class="cv_-_computer_voice">orderBy</span>) or descending order (<span class="cv_-_computer_voice">orderByDescending</span>). Next, take the result of that method and specify the second-level sort column by calling its <span class="cv_-_computer_voice">thenBy</span> method for ascending order, or <span class="cv_-_computer_voice">thenByDescending</span> method for descending order. You can call <span class="cv_-_computer_voice">thenBy</span> or <span class="cv_-_computer_voice">thenByDescending</span> as many times as desired for third-level sorting, and so forth.</div>
      <div class="B_-_Body"><a name="2188754">All these methods take a block as their one argument. That block must take exactly one argument, which is the </a>type of the entity for which you are searching. This block is a highly unusual type of block. The Gosu query builder introspects within the block you define and extracts information from it. However, at no time does Gosu actually execute this block. In essence, the block plays the role of a container for you to specify the database column to search. Gosu implements this ordering-related argument as a block because it forces column names to be checked at compile time against the data model.</div>
      <div class="B_-_Body"><a name="2188755">To specify a database column, use the following syntax for the block:</a></div>
      <div class="CS_-_Code_Single_Line"><a name="2188756">\ row -&gt; row.</a><span class="pc_-_parameter_in_code">PROPERTY</span></div>
      <div class="B_-_Body"><a name="2188757">For example, to specify to sort on the </a><span class="cv_-_computer_voice">LastName</span> property, use the syntax:</div>
      <div class="CS_-_Code_Single_Line"><a name="2188758">\ row -&gt; row.LastName</a></div>
      <div class="B_-_Body"><a name="2236189">Alternatively, you can order by the result of a database function, using the </a><span class="cv_-_computer_voice">DBFunction</span> class. For example:</div>
      <div class="CS_-_Code_Single_Line"><a name="2188760">\ row -&gt; DBFunction.Max(row.LastName)</a></div>
      <div class="B_-_Body"><a name="2188762">Gosu result set objects support the ordering methods listed in the following table.</a></div>
      <div class="T_-_Table"><a name="2188784">&nbsp;</a></div>
      <table class="withHeading" style="text-align: left;" cellspacing="10" summary="">
        <caption></caption>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; padding-bottom: 2pt; padding-left: 2pt; padding-right: 8pt; padding-top: 2pt; vertical-align: bottom;">
            <div class="TH_-_Table_Heading"><a name="2188765">Method</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; padding-bottom: 2pt; padding-left: 2pt; padding-right: 8pt; padding-top: 2pt; vertical-align: bottom;">
            <div class="TH_-_Table_Heading"><a name="2188767">Description</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 2pt; padding-left: 2pt; padding-right: 8pt; padding-top: 2pt; vertical-align: top;">
            <div class="TT_-_Table_Text" style="color: #000000; font-family: &quot;Lucida Sans Typewriter&quot;; font-style: normal; font-variant: normal; font-weight: normal; margin-top: 3.0pt; text-transform: none; vertical-align: baseline;"><span class="cvt_-_computer_voice_table"><a name="2188769">orderBy</a></span></div>
          </td>
          <td style="border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 2pt; padding-left: 2pt; padding-right: 8pt; padding-top: 2pt; vertical-align: top;">
            <div class="TT_-_Table_Text"><a name="2188771">Clears all previous ordering, then orders results by the specified column in ascending order.</a></div>
          </td>
        </tr>
        <tr>
          <td style="padding-bottom: 2pt; padding-left: 2pt; padding-right: 8pt; padding-top: 2pt; vertical-align: top;">
            <div class="TT_-_Table_Text" style="color: #000000; font-family: &quot;Lucida Sans Typewriter&quot;; font-style: normal; font-variant: normal; font-weight: normal; margin-top: 3.0pt; text-transform: none; vertical-align: baseline;"><span class="cvt_-_computer_voice_table"><a name="2188773">orderByDescending</a></span></div>
          </td>
          <td style="padding-bottom: 2pt; padding-left: 2pt; padding-right: 8pt; padding-top: 2pt; vertical-align: top;">
            <div class="TT_-_Table_Text"><a name="2188775">Clears all previous order methods, and orders by the specified column in descending order.</a></div>
          </td>
        </tr>
        <tr>
          <td style="padding-bottom: 2pt; padding-left: 2pt; padding-right: 8pt; padding-top: 2pt; vertical-align: top;">
            <div class="TT_-_Table_Text" style="color: #000000; font-family: &quot;Lucida Sans Typewriter&quot;; font-style: normal; font-variant: normal; font-weight: normal; margin-top: 3.0pt; text-transform: none; vertical-align: baseline;"><span class="cvt_-_computer_voice_table"><a name="2188777">thenBy</a></span></div>
          </td>
          <td style="padding-bottom: 2pt; padding-left: 2pt; padding-right: 8pt; padding-top: 2pt; vertical-align: top;">
            <div class="TT_-_Table_Text"><a name="2188779">Orders by the specified column in ascending order. Does not clear previous orderings.</a></div>
          </td>
        </tr>
        <tr>
          <td style="padding-bottom: 2pt; padding-left: 2pt; padding-right: 8pt; padding-top: 2pt; vertical-align: top;">
            <div class="TT_-_Table_Text" style="color: #000000; font-family: &quot;Lucida Sans Typewriter&quot;; font-style: normal; font-variant: normal; font-weight: normal; margin-top: 3.0pt; text-transform: none; vertical-align: baseline;"><span class="cvt_-_computer_voice_table"><a name="2188781">thenByDescending</a></span></div>
          </td>
          <td style="padding-bottom: 2pt; padding-left: 2pt; padding-right: 8pt; padding-top: 2pt; vertical-align: top;">
            <div class="TT_-_Table_Text"><a name="2188783">Orders by the specified column in descending order. Does not clear previous orderings.</a></div>
          </td>
        </tr>
      </table>
      <div class="B_-_Body"><a name="2188785">The argument to the block is the row. The block must contain the following types:</a></div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="2191350">A Gosu expression that returns a field path to a simple property. In other words, a period-delimited </a>expression starting with the block variable for the row, and ending in a non-foreign-key database property. An example of a simple version of a field path is <span class="cv_-_computer_voice">row.LastName</span>. You can have longer field paths if intermediate property accesses are foreign keys. For example <span class="cv_-_computer_voice">row.MyChildEntity.AnotherChildEntity.LastName</span>. Every foreign key property and the final property access must be database-backed properties. They cannot include virtual properties, methods, or any other types of calculations.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="2188787">A single legal </a><span class="cv_-_computer_voice">DBFunction</span> reference. You cannot nest database functions or combine them in any way within a single block. (You can, however, include multiple <span class="e_-_emphasis">order by</span> or <span class="e_-_emphasis">then by</span> clauses, each of which contains one database function.)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2190160">So, for example, the following is legal:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190161">var q = Query.make(TestA)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190162">q.compare("A", Equals, 11)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188791">var result = q.select()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188792">result.orderBy(\row-&gt; row.A2).thenByDescending(\row-&gt;row.E.E)</a></PRE>
      <div class="B_-_Body"><a name="2190155">The following is illegal because mathematical operators such as addition are disallowed within blocks that work </a>with <span class="e_-_emphasis">order by</span> or <span class="e_-_emphasis">then by</span> clauses:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190156">var q = Query.make(TestA)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190157">q.compare("A", Equals, 11)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233959">var result = q.select()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2233960">result.orderBy(\row-&gt; row.A2 + 10 ).thenByDescending(\row-&gt;row.E.E + 20 )</a></PRE>
      <div class="HS_-_Head_Sub"><a name="2236402">Locale Sensitivity for Ordering</a></div>
      <div class="B_-_Body"><a name="2236416">Ordered database query results automatically uses </a><span class="s_-_strong">locale-sensitive</span> comparison.</div>
      <div class="B_-_Body"><a name="2236440">In contrast, note that the collection enhancement methods for sorting and ordering rely on comparison methods </a>built into the Java interface <span class="cvt_-_computer_voice_table">java.lang.Comparable</span>. Because of this, those methods do not sort <span class="cvt_-_computer_voice_table">String</span> values in a locale-sensitive way.</div>
      <div class="H2_-_Heading_2"><a name="2233962">Found Entities Are Read-only Until Added to a Bundle</a></div>
      <div class="B_-_Body"><a name="2210891">Entities that you iterate across after a find query are read-only by default. The entity is loaded in a read-only </a><span class="e_-_emphasis">bundle</span>, which is a collection of entities loaded from the database into server memory. By default, find query results are returned in their own read-only bundle separate from the active read-write bundle of any running code. </div>
      <div class="B_-_Body"><a name="2210893">To change a read-only entity’s properties, you must move the entity to a new writable bundle. Typical code adds </a>the entity to the <span class="e_-_emphasis">current bundle</span> of the running code. For example, if your Gosu code is triggered from a rule set or a plugin method, there is a current bundle that you can access. Simply add each entity to the new bundle to permit changes to the entity and mark the entity as changed. After the entity changes and the new bundle commits successfully, all entity changes are copied to the database. Remember that an entity cannot safely exist in more than one writable (read-write) bundle.</div>
      <div class="B_-_Body"><a name="2210894">To move the entity to a writable bundle, call the </a><span class="cv_-_computer_voice">add</span> method on a bundle and save the result of the <span class="cv_-_computer_voice">add</span> method.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2210895">If you passed a read-only entity to a writable bundle, the return result of the </a><span class="cv_-_computer_voice">add</span> method is a cloned instance of the entity you passed to the method. If you want a reference to the entity so you can make further changes, you must keep a reference to the <span class="s_-_strong">return</span><span class="s_-_strong">&nbsp;</span><span class="s_-_strong">result</span> of the <span class="cv_-_computer_voice">add</span> method. Do not modify the original entity reference. Do not keep a reference to the original entity.</div>
      <div class="B_-_Body"><a name="2210896">For example:</a></div>
      <PRE class="CF_-_Code_First_Line"><a name="2210897">// get the current (ambient) bundle of the runing code</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210898">var bundle = gw.transaction.Transaction.getCurrent()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210968">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210969">var query = Query.make(TestA)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210970">query.compare("A", Equals, 11)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210940">var result = query.select()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210941">result.orderBy(\row-&gt; row.A2).thenByDescending(\row-&gt;row.E.E)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210901">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210902">for( c in query ) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210903">&nbsp;</a>&nbsp;bundle.add(c)</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210904">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210905">&nbsp;</a>&nbsp;// make changes to one or more properties directly on the entity or its subobjects</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210906">&nbsp;</a>&nbsp;c.MyProperty1 = true</PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="2210907">}</a></PRE>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2210910">For more information about bundles and transactions, see </a><a href="javascript:WWHClickedPopup('gosu', 'transactions.21.1.html#1456387', '');" title="Bundles and Transactions">"Bundles and Transactions"</a>, which discusses the issue and related APIs in much more detail.</div>
      <div class="H2_-_Heading_2"><a name="2210976">Result Counts and Dynamic Queries</a></div>
      <div class="B_-_Body"><a name="2210977">A query is always dynamic and returns results that may change if you use the object again. Some results may </a>have been added, changed, or removed from the database from one use of the query object to another use of the query, even within the same function.</div>
      <div class="B_-_Body"><a name="2210978">The </a><span class="cv_-_computer_voice">Count</span> property of a query gets the current count of items. A common mistake is to rely on the count number remaining constant. That number might be useful in some contexts such as simple user interface display such as “displaying items 1-10 out of 236 results”. However, it might be different from the number of items returned from a query even if you iterate across it <span class="s_-_strong">immediately</span> afterward. Some results may add, change, or remove from the database between the time you call the <span class="cv_-_computer_voice">count</span> method and when you iterate across it.</div>
      <div class="HS_-_Head_Sub"><a name="2210979">Bad Example:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210980">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210981">// Bad example. Do NOT follow this example. Do NOT rely on the result count staying constant! </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210982">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2211083">// create a query</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2211084">var query = Query.make(TestA)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2211085">query.compare("A", Equals, 11)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210984">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2211113">// THE FOLLOWING LINE IS UNSAFE</a></PRE>
      <PRE class="CM_-_Code_Middle_Line" style="font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline;"><span class="s_-_strong"><a name="2210985">var myArray = new Claim[ query.select().count() ];</a></span></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2219342">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2219343">For ( x in query.select() index y )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2219344">{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2211130">&nbsp;</a>&nbsp;&nbsp;// this line throws out of bounds exception if more results appear since the count was calculated</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210989">&nbsp;</a>&nbsp;&nbsp;myArray[y] = x; </PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2210990">}</a></PRE>
      <div class="B_-_Body"><a name="2210992">In most cases, code like this risks throwing array-out-of-bounds errors at run time. </a></div>
      <div class="B_-_Body"><a name="2211620">Instead, iterate across the set and count upward, appending query result entities to a </a><span class="cv_-_computer_voice">List</span>.</div>
      <div class="HS_-_Head_Sub"><a name="2211621">Good Example:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234105">uses java.util.ArrayList</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234106">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234107">var q = Query.make(User)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234108">q.compare("IntegerExt", NotEquals, 11)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234109">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234110">// create a new list, and use generics to parameterize it</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234111">var myList = new ArrayList&lt;User&gt;()   </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234112">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234113">var maxResult = 100</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234114">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234115">for ( x in q.select() index i)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234116">{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234117">   if (i &gt; maxResult) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234118">     break</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234119">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234120">  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234121">  // add a search result to the list</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234122">  myList.add(x); </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234123">}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2211622">&nbsp;</a></PRE>
      <div class="B_-_Body"><a name="2211626">The important thing to remember is that calling </a><span class="cv_-_computer_voice">query.select()</span> does not snapshot the current value of the result set forever. When you access the <span class="cv_-_computer_voice">query.select().Count</span> property, ClaimCenter runs the query but the query contents can change quickly. Database changes could happen in another thread on the current server or on another server in the cluster. </div>
      <div class="H3_-_Heading_3"><a name="2211660">Setting the Page Size For a Query</a></div>
      <div class="B_-_Body"><a name="2234020">As you use the result object to iterate </a><span class="s_-_strong">across</span> the query results, ClaimCenter runs the query. However, Gosu does not typically run the query each time you access the next result in the query. Instead, Gosu automatically loads several results from the query in a batch at one time and caches it for quick access. This means that common actions like iterating across the query are higher performance. </div>
      <div class="B_-_Body"><a name="2234063">You can customize the number of results to load in each batch. To set the page size, call the </a><span class="cv_-_computer_voice">setPageSize</span> method on the query result object, which is the return value of <span class="cv_-_computer_voice">query.select()</span>.</div>
      <div class="B_-_Body"><a name="2211670">For example:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234225">var q = Query.make(User)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234197">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234204">// load 10 entities at one time and cache them</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2234183">q.select().setPageSize(10)</a></PRE>
      <div class="B_-_Body"><a name="2234186">Other notes:</a></div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="2234189">If you plan to modify the entities, see related section </a><a href="javascript:WWHClickedPopup('gosu', 'querybuilder.09.7.html#2233962', '');" title="Returning Query Results">"Found Entities Are Read-only Until Added to a Bundle"</a>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt;">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="2211735">In real-world code, be careful not to retrieve too many items and keep references to them. Memory errors </a>and performance problems can occur. Design your code to limit the result set that your code returns.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2234081">Always test database performance under realistic real-world conditions before and after </a>changing any performance tuning settings.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </div>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>