<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Variable Scope and Capturing Variables In Blocks</title>
    <link rel="StyleSheet" href="css/blocks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>Gosu Reference Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="blocks.17.1.html#1443613">Gosu Blocks</a> : Variable Scope and Capturing Variables In Blocks</span></div>
    <hr align="left" />
    <blockquote>
      <div class="H1_-_Heading_1"><a name="1443613">Variable Scope and Capturing Variables In Blocks</a></div>
      <div class="B_-_Body"><a name="1445380">Gosu blocks maintain some context with respect to the enclosing statement in which they were created. If code in </a>the block refers to variables that are defined outside the scope of the block’s definition but in scope where the block is defined, the variable is <span class="e_-_emphasis">captured.</span> The variable is incorporated <span class="s_-_strong">by</span><span class="s_-_strong">&nbsp;</span><span class="s_-_strong">reference</span> into the block. Incorporating the variable by&nbsp;reference means that blocks do not merely capture the current value of the variable at the time its enclosing code creates the block. If the variable changes after the enclosing code creates the block, the block gets or sets the most recent value in the <span class="e_-_emphasis">original</span> scope. This is true even if the <span class="e_-_emphasis">original</span> scope exited (finished).</div>
      <div class="B_-_Body"><a name="1444894">The following example adds 10 to a value. However, the value 10 was captured in a local variable, rather than </a>included in an argument. The captured variable (called <span class="cv_-_computer_voice">captured</span> in this example) is used but not defined within the block:</div>
      <PRE class="CF_-_Code_First_Line"><a name="1435098">var captured = 10</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1435099">var addTo10 = \ x : Number -&gt; captured + x </a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="1435100">var myresult = addTo10(10)</a></PRE>
      <div class="B_-_Body"><a name="1437179">After the third line is executed, </a><span class="cv_-_computer_voice">myresult</span> contains the value 20.</div>
      <div class="B_-_Body"><a name="1437638">A block captures the state of the stack at the point of its declaration, including all variables and the special </a>symbol <span class="cv_-_computer_voice">this</span>, which represents the current object. For example, the current instance of a Gosu class running a method. </div>
      <div class="B_-_Body"><a name="1444914">This capturing feature allows the block to access variables in scope </a><span class="e_-_emphasis">at its definition</span>:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1445904">...even after being passed as an argument to another function </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1445905">...even after the block returns to the function that defines it</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1445906">...even if some code assigns it to a variable and keeps it around indefinitely</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1437754">...even after the original scope exits (after it finishes)</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1437757">In other words, each time the block runs, it can access all variables declared in that original scope in which it was </a>defined. The block can get or set those variables. The values of captured variables are evaluated each time the block is executed, and can be read or set as desired. Captured variable values are <span class="s_-_strong">not</span> simply a static snapshot of their value at the time the block was created.</div>
      <div class="B_-_Body"><a name="1437792">To illustrate this point further, the following example creates a block that captures a variable (</a><span class="cv_-_computer_voice">x</span>) from the surrounding scope. Next, the code that created the block changes the value of <span class="cv_-_computer_voice">x.</span> Only after that change does any code actually call the block:</div>
      <PRE class="CF_-_Code_First_Line"><a name="1437793">// define a local variable, which is captured by a block</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1444926">var x = 10</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437794"> </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437852">// create the block</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437853">var captureX = \ y : Number -&gt; x + y</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437795">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437854">// Note: the variable "x" is now SHARED by the block and the surrounding context</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437856">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437857">// Now change the value of "x"</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437858">x = 20</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437796">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437861">// at the time the block runs, it uses the current value of x, </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437881">// this is NOT a snapshot of what it was at the time block was created</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1437859">var z = captureX( 10 ) </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1444844">&nbsp;</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="1444845">print(z) // prints 30</a>&nbsp;&nbsp; --- not 20!!!</PRE>
      <div class="B_-_Body"><a name="1444942">The captured variable is effectively </a><span class="s_-_strong">shared</span> by the original scope and the block that was created within that scope. In other words, the block references the variable itself, not merely its original value.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="1444943">If accessing variables not defined within the block definition, blocks effectively share </a>the variable with the context that created it. This is true even if the original scope exited (finished) or its value has changed. This is a very powerful feature. If you use this feature at all, use it very carefully and document your assumptions so people who read your code can understand and debug it.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>