<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Selecting Columns and Returning Results in Custom Formats</title>
    <link rel="StyleSheet" href="css/querybuilder.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>Gosu Reference Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="querybuilder.09.01.html#2233459">Query Builder</a> : <a class="WebWorks_Breadcrumb_Link" href="querybuilder.09.08.html#2233459">Returning Query Results</a> : Selecting Columns and Returning Results in Custom Formats</span></div>
    <hr align="left" />
    <blockquote>
      <div class="H2B_-_Heading_2_Break"><a name="2233459">Selecting Columns and Returning Results in Custom Formats</a></div>
      <div class="B_-_Body"><a name="2188701">In many situations you only need a few columns from the result instead of the whole entity. You can use a variant </a>of the <span class="cvt_-_computer_voice_table">select</span> method to do this. The <span class="cvt_-_computer_voice_table">select</span> method is only available off of queries.</div>
      <div class="B_-_Body"><a name="2190834">Instead of calling the </a><span class="cv_-_computer_voice">select</span> method with no arguments, use an alternate method signature that takes a <span class="e_-_emphasis">block</span>. A block is an in-line function that you define within another function. For more information about blocks, see <a href="javascript:WWHClickedPopup('gosu', 'blocks.17.1.html#1445150', '');" title="Gosu Blocks">“Gosu Blocks”</a>. You pass a block that takes an object of the query type and returns whatever you want. The return type can be anything that you specify. Any arbitrary type is fine, so you can choose whatever is most convenient for your program. The type does not need to match the native types for the columns in the database. </div>
      <div class="B_-_Body"><a name="2190864">The full method signature of this alternate </a><span class="cvt_-_computer_voice_table">select</span> method is the following:</div>
      <div class="CS_-_Code_Single_Line"><a name="2188703">function select&lt;RT&gt;(columns : block(row : QT) : RT) : IQueryResult&lt;QT, RT&gt;</a></div>
      <div class="B_-_Body"><a name="2213875">Note that the function returns an </a><span class="cv_-_computer_voice">IQueryResult</span> parameterized by the original query type, as well as the return type of your block. This allows Gosu to infer the block return type from the type of the query due to how Gosu generics work. You do not need to specify the return type of your block explicitly. For related topics, see <a href="javascript:WWHClickedPopup('gosu', 'generics.18.5.html#1447291', '');" title="Generics and Blocks">“Generics and Blocks”</a> and <a href="javascript:WWHClickedPopup('gosu', 'generics.18.6.html#1441541', '');" title="How Generics Help Define Collection APIs">“How Generics Help Define Collection APIs”</a>.</div>
      <div class="B_-_Body"><a name="2190908">This alternative select method provides the following important benefits:</a></div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><span class="ri_-_run_in_header"><a name="2190923">Gosu only loads the columns you need.</a></span> The database returns <span class="s_-_strong">only</span> the columns you access in your block. This reduces memory usage and improves overall server performance.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><span class="ri_-_run_in_header"><a name="2190946">You can assemble arbitrary structures or calculations to return in place of full entities.</a></span> Since you are not retrieving the entire entity, you choose how to return each result. For example, you can populate a custom Gosu class containing only the fields you need. Or you can simply return a single field that you need, such as a public ID string.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2190998">Gosu determines which columns to load by inspecting the block at compile time (at a low level) to determine </a>which database columns are affected by the query. At compile time, Gosu looks inside the block <span class="s_-_strong">without </span><span class="s_-_strong">running</span> it. By detecting that you referenced the <span class="cvt_-_computer_voice_table">Address1</span> property on an <span class="cvt_-_computer_voice_table">Address</span> entity, Gosu knows that it must load the <span class="cvt_-_computer_voice_table">Address1</span> property. Any properties not mentioned at all in your block are not loaded from the database for this query.</div>
      <div class="B_-_Body"><a name="2191092">As you iterate across the result set, after a row loads from the database, Gosu runs your block.</a></div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="2191016">Gosu actually inspects the parse tree of the </a><span class="cv_-_computer_voice">select</span> block to determine which properties to load at run time. For each result in the result set, Gosu executes your block and replaces the values of database columns with values from the database. </div>
      <div class="B_-_Body"><a name="2190999">Gosu imposes the following rules on what kinds of tasks you can do inside the Gosu block:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2191000">All references from the block argument (the database row) must be references to properties backed by actual </a>database columns. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="2191192">You cannot use virtual properties, enhancement methods, or other entity methods within </a>the block that you pass to select. If you are unsure which properties are backed by actual database columns, refer to the <span class="e_-_emphasis">Data Dictionary</span>.</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap;">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2191001">Any references to a database function, which are static methods on the </a><span class="cv_-_computer_voice">DBFunction</span> class, must contain exactly one column reference. Additionally that column reference can have a cast associated with it, and that cast becomes a database cast in the final output). </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2190194">For example, to extract two database columns into a hash map mapping a </a><span class="cv_-_computer_voice">String</span> to <span class="cv_-_computer_voice">Integer</span>, you could use code similar to the following:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190196">var rows = Query.make(MyEntity).select(\row-&gt; new HashMap&lt;String, Integer&gt;() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188712">&nbsp;</a>&nbsp;"A" -&gt; row.A,</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188713">&nbsp;</a>&nbsp;"E" -&gt; row.E</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190190">})</a></PRE>
      <div class="B_-_Body"><a name="2190191">This returns an </a><span class="cv_-_computer_voice">IQueryResult&lt;</span><span style="font-family: &quot;Lucida Sans Typewriter&quot;; font-size: 7.0pt">MyEntity</span><span class="cv_-_computer_voice">, HashMap&lt;String,Integer&gt;&gt;</span>. The <span class="cv_-_computer_voice">IQueryResult</span> class extends <span class="cv_-_computer_voice">Iterable</span>, more specifically <span class="cv_-_computer_voice">IQueryResult&lt;QT,RT&gt;</span> extends <span class="cv_-_computer_voice">Iterable&lt;RT&gt;</span>. This means that this method returns an iterable object of type <span class="cv_-_computer_voice">Iterable&lt;HashMap&lt;String,Integer&gt;&gt;</span>.</div>
      <div class="B_-_Body"><a name="2188716">In the previous example, note the references to </a><span class="cv_-_computer_voice">row.A</span> and <span class="cv_-_computer_voice">row.E</span>. In the final result, these references become database references.</div>
      <div class="B_-_Body"><a name="2190185">The following is a more subtle example that fetches three columns, assuming that MyEntity.E references an </a>entity that contains properties named E1 and E2:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190187">var rows = Query.make(MyEntity).select(\row-&gt; new HashMap&lt;String, Integer&gt;() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188720">&nbsp;</a>&nbsp;"A_plus_ten" -&gt; row.A + 10,</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188721">&nbsp;</a>&nbsp;"E1_minus_E2" -&gt; row.E.E1 - row.E.E2</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188722">})</a></PRE>
      <div class="B_-_Body"><a name="2188723">The columns in the following example are more subtle. This fetches three columns from the database:</a></div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt; margin-bottom: 2.0pt; margin-top: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span class="cvt_-_computer_voice_table"><a name="2190585">row.A</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt; margin-bottom: 2.0pt; margin-top: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span class="cvt_-_computer_voice_table"><a name="2190600">row.E.E1</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt; margin-bottom: 2.0pt; margin-top: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap;color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span class="cvt_-_computer_voice_table"><a name="2190608">row.E.E2</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="2190180">Note that Gosu permits the line with a computation computes </a><span class="cv_-_computer_voice">row.A + 10</span>. Gosu does not optimize this using the SQL feature called <span class="e_-_emphasis">computed</span><span class="e_-_emphasis">&nbsp;</span><span class="e_-_emphasis">columns</span>. Gosu query builder does not support computed columns. Instead, Gosu simply loads the columns from the database and performs the calculation in the Gosu block at run time. Be aware of this implementation detail if you implement complex calculations in your block. If you have complex calculations in your block, remember to test and profile performance at run time with large loads to determine the performance impact of your calculations.</div>
      <div class="B_-_Body"><a name="2191237">The following is a complex example that returns a custom anonymous inner class and initializing two properties </a>(A and E): </div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190182">&nbsp;</a>&nbsp;var rows = Query.make(TestA).select(\row-&gt; {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188728">      if (row.A &lt; 10) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188729">        return new MyObject() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188730">          :A row.A + 10,</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188731">          :E -&gt; row.E.E1 - row.E.E2</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188732">        })</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188733">      } else {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188734">        return new MyObject() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188735">          :A row.A + 1000,</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188736">          :E -&gt; row.E.E1 + row.E.E2</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188737">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188738">    }</a></PRE>
      <div class="HS_-_Head_Sub"><a name="2190175">Database Functions Within Select Blocks</a></div>
      <div class="B_-_Body"><a name="2191311">The following is an example that uses a database function:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190177">var rows = Query.make(TestA).select(\row-&gt; new HashMap&lt;String, Integer&gt;() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188746">      "A" -&gt; DBFunction.SUM(row.A as double),</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2188747">      "A2" -&gt; row.A2</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2190170">    })</a></PRE>
      <div class="B_-_Body"><a name="2190171">It returns the summary of all </a><span class="cv_-_computer_voice">TestA.A</span>, coerced to <span class="cv_-_computer_voice">double</span> to show how to do coercion, and then finally grouped by the property <span class="cv_-_computer_voice">TestA.A2</span>.</div>
      <div class="B_-_Body"><a name="2190172">Within your block, you can use the following database functions: </a><span class="cv_-_computer_voice">Sum</span>, <span class="cv_-_computer_voice">Max</span>, <span class="cv_-_computer_voice">Min</span>, <span class="cv_-_computer_voice">Avg</span>, and <span class="cv_-_computer_voice">Count</span>.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>